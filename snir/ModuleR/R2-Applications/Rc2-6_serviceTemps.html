<!DOCTYPE html>

<html 
	data-module="R"
	data-pagetype="Chapitre"
	data-modulepartnumber="2"
	data-pagenumber="VI"
	data-pageState="travaux"
	data-pageheadtitle="Services de temps"
	data-pagefulltitle="Les services de temps"
	data-authorname="François GIRAULT"
	data-authormail="francois.girault@ac-versailles.fr"
	lang="fr">

<script src="../../js/operateData.js"></script>

<!-- The following script MUST be coded here and not anywhere else! -->
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

<head> 
	<meta charset="utf-8">
	<script src="../../js/makeHead.js"></script>
</head>

<body>

<nav id="navPannel" style="display: block">
	<script src="../../js/makeNavPannel.js"></script>
</nav>

<div id="mainFrame">
  
<header class="band">
  <script src="../../js/makeHeader.js"></script>
</header>	

<div id="scrollingFrame">

<footer class="band">
	<script src="../../js/makeFooter.js"></script>
</footer>

<section>

<div id="mainTitle">
	<script src="../../js/makeTitle.js"></script>
</div>











<div class="exergue" id="intro"> 
<div style="display:inline-block">	
	<img class="top-right" src="../img/quartzArduino.jpg" width="300px" style="padding-top: 1em">
<p class="square"> Toute machine informatique dispose d'une <strong class="defin">horloge interne</strong> pour cadencer son processeur. Le le plus souvent, cette horloge est basée sur un <strong>oscillateur électronique à quartz</strong> externe <a class="external" href="https://fr.wikipedia.org/wiki/Oscillateur_(électronique)" target="_BLANK">W</a> (cf. celui d'une carte <em class="mark">Arduino</em> en photo ci‑contre). Ce dispositif génère un <strong>signal périodique d'horloge</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Signal_d'horloge" target="_BLANK">W</a> de (très) haute fréquence – au moins 1 MHz, mais le plus souvent de l'ordre du GHz. Il définit ce qu'on appelle le <strong class="title">temps processeur</strong> (cf. chap. C2‑VIII <a class="previous" href="../../ModuleC/C2-ElementsLangage/Cc2-8_gestionTemps.html" target="_BLANK"></a>). </p>
</div><!-- display -->

<div style="display:inline-block">	
	<img class="top-right" src="../img/horlogeWindows.png" width="200px" style="padding-top: 0.2em">
<p> En comptant le nombre d'impulsions du signal d'horloge depuis un <strong>instant initial</strong>, on peut en déduire la <strong>durée écoulée</strong>, et donc, moyennant quelques calculs, implémenter un <strong class="title">temps calendaire</strong>, c'est‑à‑dire une horloge qui indique la <strong class="specialLB">date et heure courante</strong> conformément à la <strong>localisation</strong> du système, c'est‑à‑dire sa position dans le système des zones horaires du monde (cf. la capture d'écran ci‑contre sur un PC <em class="mark">Windows</em>). </p>
	
<p> Néanmoins, tout oscillateur électronique comporte des <strong class="warning">imperfections</strong> qui lui sont propres. Au fil du temps, même un écart minime sur la fréquence d'oscillation par rapport à la valeur théorique finit par engendrer une <strong class="cons">dérive significative</strong> du système d'horodatage de la machine, avec des <strong class="title">conséquences non négligeables</strong>. </p>
</div><!-- display -->


<ul>
	<div style="display:inline-block">
		<img class="top-right" src="../img/horodatageCmd.png" width="230px" style="margin-top:0.7em">
	<li> Dans le cas d'un <strong class="specialLB">poste de travail</strong>, tout l'<strong>étiquetage</strong> des fichiers et des processus (cf. la capture d'écran ci‑contre) risque d'être <strong class="cons">faussé</strong> par rapport à la réalité. </li>
  </div><!-- display -->
	<li> Dans un <strong class="specialLB">réseau informatique</strong>, certains services – notamment la messagerie électronique, les requêtes sur bases de données – requièrent une bonne <strong>synchronisation</strong> entre les machines, qui peut être <strong class="cons">compromise</strong> par un écart entre les horloges respectives des serveurs. </li>
  
  <div style="display:inline-block">
		<img class="top-right" src="../img/horodatageOeufs.png" width="150px" style="margin-top:0.5em">
	<li> Dans un <strong class="specialLB">système de production</strong> qui met en œuvre un <strong>processus d'horodatage</strong> des produits, si ce dernier n'est pas exact, cela risque de poser des <strong class="cons">problèmes ultérieurs de traçabilité</strong>. </li>
	</div><!-- display -->
</ul>
<p> On comprend donc la nécessité de <strong class="defin">synchroniser régulièrement les horloges</strong> des machines avec une <strong class="pros">référence de temps commune</strong>.</p>



<div style="display:inline-block">	
	<img class="top-right" src="../img/horlogeAstroPrague.jpg" width="180px" style="padding-top: 1.2em">
<p class="square"> Mais définir une <strong class="title">référence de temps commune</strong> n'est <strong class="warning">pas simple</strong>. Cette problématique ancienne, qu'on a cru pouvoir résoudre avec les observations astronomiques, s'est complexifiée avec l'amélioration des techniques de mesure du temps. Aujourd'hui, on distingue principalement <strong class="specialLB">deux échelles</strong> de temps. </p>
</div><!-- display -->

<ul>
	<div style="display:inline-block">	
		<img class="top-right" src="../img/tempsUniversel.jpg" width="180px" style="padding-top: 0.5em">
	<li> D'une part, on a le <strong class="specialLB">temps universel</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_universel" target="_BLANK">W</a> (<em class="english">universal time</em>, abrégé <em class="bold"><em class="sigle">UT</em></em>) qui est basé sur les notions de <strong class="defin">jour solaire moyen</strong> et d'<strong class="defin">année tropique</strong>. L'inconvénient de cette unité est qu'elle a une <strong class="cons">durée variable</strong> (certes, très faiblement, mais néanmoins gênante lorsqu'il s'agit de chronométrer des phénomènes). En revanche, elle offre à l'échelle d'une année une <strong class="pros">synchronisation</strong> avec l'alternance des <strong>jours</strong> et des <strong>saisons</strong> que l'on constate sur Terre, donc en phase avec les activités humaines.   </li>
	</div><!-- display -->

	<div style="display:inline-block">	
		<img class="top-right" src="../img/tempsAtomique.jpg" width="180px" style="padding-top: 0.5em">
	<li> D'autre part, on a le <strong class="specialLB">temps atomique international</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_atomique_international" target="_BLANK">W</a> (<em class="english">international atomic time</em>, abrégé <em class="bold"><em class="sigle">TAI</em></em>) qui est <strong>exclusivement</strong> basée sur la définition atomique de la <strong class="defin">seconde</strong> comme unité fondamentale du temps propre terrestre (car sa valeur est très proche d'une fraction remarquable du jour solaire moyen). Aux incertitudes techniques près, la durée d'une seconde atomique est <strong class="pros">extrêmement stable</strong>. </li>
	</div><!-- display -->
</ul>

<div class="expert">
<p> Si le <strong class="specialLB">temps atomique international</strong> est privilégié pour les <strong>expériences scientifiques</strong>, il n'est en revanche <strong class="defin">pas retenu</strong> comme référence pour le <strong>temps civil</strong> – et donc dans les systèmes informatiques – car il présente une <strong class="cons">dérive</strong> par rapport au temps universel, certes <strong>très faible</strong> (de l'ordre d'une minute par siècle) mais techniquement insatisfaisante : il est difficile d'accepter que les saisons se décalent peu à peu dans le calendrier. </p>
</div><!-- expert -->

<div style="display:inline-block">	
	<img class="top-right" src="../img/UTC.jpg" width="300px" style="padding-top: 0.2em">
<p> Depuis la fin des années 1960, c'est un concept intermédiaire appelé <strong class="title">temps universel coordonné</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_universel_coordonné" target="_BLANK">W</a> (en anglais, <em class="english">coordinated universal time</em>), abrégé officiellement <strong class="title"><em class="sigle">UTC</em></strong>, qui est adopté, pour offrir un <strong class="pros">bon compromis</strong> entre les deux échelles de temps présentées supra. </p>
</div><!-- display -->

<p class="square"> L'adoption de l'<strong><em class="sigle">UTC</em></strong> comme <strong>référence de temps mondiale</strong> n'a de sens que si elle peut être facilement partagée entre les machines. Sur l'Internet ont donc été développés des <strong class="title">protocoles de communication</strong> spécifiques : d'abord <strong><em class="sigle">TP</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/Time_Protocol" target="_BLANK">W</a> (<em class="english">time protocol</em>) puis <strong class="specialLB"><em class="sigle">NTP</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/Network_Time_Protocol" target="_BLANK">W</a> — pour <strong class="specialLB">network time protocol</strong> – dont la version 4 (juin 2010) est la plus récente aujourd'hui. C'est sur ce protocole que reposent la plupart des <strong class="defin">services de temps</strong> sur les réseaux. </p>

<p> Comme presque tous les protocoles applicatifs, <strong><em class="sigle">NTP</em></strong> est conçu sur un <strong class="defin">modèle client‑serveur</strong> et une <strong class="defin">architecture spécifique</strong>. Pour un technicien réseau, il est nécessaire d'en connaître les bases, auquel le présent chapitre est justement consacré, avec les <strong class="title">objectifs</strong> listés ci‑dessous  </p>
<ul>
	<li> Tout d'abord, on décrit la <strong class="specialLB">problématique générale de la définition du temps</strong>, en rappelant : </li>
	<ul>
	 	<li> d'une part, la définition de la <strong class="defin">seconde atomique</strong> qui constitue l'étalon de durée ;  </li>
	 
	 	<li> d'autre part, les notions de <strong class="defin">jour solaire</strong> et d'<strong class="defin">année tropique</strong>. </li>
	</ul>

	<div class="nobullet" style="margin-top: 0.5em"> On peut alors introduire : </div>
	<ul>
		<li> la notion de <strong class="defin">temps universel</strong> et ses concepts sous‑jacents de <strong>fuseau horaires</strong> et d'<strong>heure d'été</strong>. </li>

		<li> la notion de <strong class="defin">temps universel coordonné</strong> avec la notion sous‑jacente de <strong>seconde intercalaire </strong>; </li>
	</ul>

	<li> Dans un deuxième temps, on aborde les <strong class="specialLB">représentations du temps calendaire</strong> dans les systèmes informatiques, en introduisant les notions de <strong class="defin">datestamp</strong> et de <strong class="defin">timestamp</strong>. </li>

	<li> Ensuite, on décrit le système de <strong class="specialLB">partage du temps universel coordonné</strong>, en détaillant l'<strong>architecture réseau</strong> pour les <strong class="defin">serveurs de temps</strong> et le <strong class="defin">protocole <em class="sigle">NTP</em></strong>. </li>

	<li> Enfin, on aborde les différentes techniques de <strong class="specialLB">manipulation des paramètres calendaires</strong> dans une machine informatique. </li>
</ul>

<div class="expert">
<p> Pour une <strong class="title">étude plus approfondie</strong>, on pourra consulter les <strong class="defin">pages web</strong> <a class="external" href="https://www.eecis.udel.edu/~mills/exec.html" target="_BLANK"></a> rédigées à titre pédagogique par l'<strong>Université du Delaware</strong>. Ce n'est pas un hasard car cette université compte parmi ses effectifs <strong>David L. Mills</strong> <a class="external" href="https://en.wikipedia.org/wiki/David_L._Mills" target="_BLANK">W</a>, professeur émérite et principal concepteur du protocole <strong><em class="sigle">NTP</em></strong>. </p>
</div><!-- expert -->

</div><!-- exergue -->


















<h2> Problématique générale de la définition du temps </h2>



<div class="expert">
<div style="display:inline-block">	
	<img class="top-right" src="../img/cadranSolaireAncien.jpg" width="220px" style="padding-top: 0.2em">
<p> La définition d'une échelle de temps constitue une <strong class="title">problématique</strong> <strong>très ancienne</strong> pour les sociétés humaines (cf. la photo d'un vestige de cadran solaire égyptien, vieux d'environ 3300 ans). La problématique a <strong class="defin">beaucoup évoluée</strong> au gré des <strong>besoins en précision</strong> requis par les activités sociales et des <strong>progrès</strong> accomplis, à la fois dans les techniques de mesure des durées et la compréhension des phénomènes astronomiques. </p>
</div><!-- expert -->

<p> Aujourd'hui, l'<strong class="title">unité de temps</strong> – la <strong class="defin">seconde</strong> – est celle qui est <strong class="pros">la mieux maîtrisée</strong> de toutes les unités du système international. Et les phénomènes astronomiques qui gouvernent le temps terrestre sont bien compris. </p>

<p> Néanmoins, cinquante ans après son adoption, l'échelle du <strong class="title">temps universel coordonné</strong> fait encore l'objet de <strong class="cons">controverses</strong> – certains scientifiques préférant qu'on privilégie le <strong>temps atomique international</strong>. </p>
</div><!-- expert -->



<h3 id="secondeAtomique"> La seconde atomique : un étalon de durée </h3>



<div class="expert">
<p> On rappelle que la <strong class="title">seconde</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Seconde_(temps)" target="_BLANK">W</a> (symbole <strong>s</strong>) est l'<strong class="defin">unité de temps</strong> du <strong>Système international d'unités</strong> (<strong><em class="sigle">SI</em></strong>). Elle y a été introduite en 1889 lors de la <em class="mark">1<sup>re</sup> Conférence générale des poids et mesures</em> <a class="external" href="https://fr.wikipedia.org/wiki/Conférence_générale_des_poids_et_mesures" target="_BLANK">W</a>.  </p>
</div><!-- expert -->

<div style="display:inline-block">	
	<img class="top-right" src="../img/Cesium133.png" width="150px" style="padding-top: 0.2em">
<p> En 1967, par la résolution nº 1 de la <em>13<sup>e</sup> Conférence générale des poids et mesures</em> <a class="external" href="https://www.bipm.org/fr/committees/cg/cgpm/13-1967/resolution-1" target="_BLANK"></a>, la <strong class="title">seconde</strong> a été définie comme la durée de <strong>9&#8239;192&#8239;631&#8239;770 périodes</strong> de la radiation correspondant à la transition entre les deux niveaux hyperfins de l'état fondamental de l'atome de <strong>césium 133</strong>.   </p>
</div><!-- display -->

<div class="important">
<p> Depuis 1967, <strong class="defin">aucun changement majeur</strong> n'a été apporté à cette définition. Seules des précisions sur l'état de l'atome de césium 133 (non perturbé, à 0 K) ont été apportées pour les mesures de sa période de radioactivité. </p>

<p> La <strong class="title">seconde</strong> constitue aujourd'hui une <strong>unité</strong> <strong class="pros">réputée fixe</strong> à <em class="bold">10<sup>−14</sup></em> <strong>près</strong>. </p>
</div><!-- important -->

<div class="complement">
<p> La <strong class="title">durée</strong> d'une seconde ainsi définie par le nombre de périodes de radioactivité de l'atome de césium a été choisie pour <strong class="pros">coïncider au mieux</strong> avec ses <strong class="defin">anciennes définitions</strong> : </p>
<ul>
	<li> d'abord un <em class="bold">86&#8239;400<sup>e</sup></em> du <strong class="defin">jour solaire terrestre moyen</strong> (unité de l'échelle du <em>temps universel</em> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_universel" target="_BLANK">W</a> adoptée jusqu'en 1956) ;  </li>

	<li> puis un <em class="bold">31&#8239;556&#8239;925,974&#8239;7<sup>e</sup></em> de l’<strong class="defin">année tropique 1900</strong> (unité de l'échelle du <em>temps des éphémérides</em> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_des_éphémérides" target="_BLANK">W</a> adoptée de 1960 à 1967). </li>
</ul>
<p> Les notions de <strong>jour solaire</strong> <a class="infra" href="Rc2-6_serviceTemps.html#jourSolaireMoyen"></a> et d'<strong>année tropique</strong> <a class="infra" href="Rc2-6_serviceTemps.html#anneeTropique"></a> sont détaillées infra. </p>
</div><!-- complement -->


<h4 id="horlogeAtomique"> Les horloges atomiques  –  le temps atomique </h4>


<div class="complement" style="display: inline-block;">
	<img class="top-right" src="../img/horlogeAtomique.png" width="300px">
<p> Une <strong class="title">horloge atomique</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Horloge_atomique" target="_BLANK">W</a> est une machine qui délivre un <strong>signal périodique</strong> de <strong class="pros">fréquence connue</strong> et <strong class="pros">très stable</strong> basée sur des <strong class="defin">phénomènes atomiques</strong>. </p>

<p> Dans le cas de <strong class="title">technologie dite à jet de césium</strong> (cf. l'équipement en photo ci‑contre à titre d'exemple), cette fréquence est de 9&#8239;192&#8239;631&#8239;770 Hz – en rappelant que 1 Hz = 1 s<sup>−1</sup>. Des dispositifs électroniques appelés <strong>diviseurs de fréquences</strong> permettent notamment d'en extraire un <strong>signal périodique</strong> de <strong class="defin">période 1 seconde</strong> très précisément. </p>
</div><!-- complement -->


<p> Les <strong class="title">horloges atomiques</strong> sont notamment utilisées pour :  </p>
<ul>
	<li> définir la <strong>seconde atomique</strong> et ainsi compter l'écoulement du <strong class="defin">temps atomique international</strong> ; </li>

	<li> par la même occasion, fournir la base du <strong class="defin">temps universel coordonné</strong> ;  </li>

	<li> implémenter un <strong>service de temps</strong> embarqué dans les satellites des <strong class="defin">systèmes de localisation</strong> (<em class="sigle">GPS</em>, <em class="mark">Glonass</em>, <em class="mark">Galileo</em>…) et plus généralement dans tous les systèmes qui requièrent une échelle de temps extrêmement précise, ne devant pas être entachée par des délais de transmission. </li>
</ul>


<div class="important">
<p> Le <strong class="title">temps atomique international</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_atomique_international" target="_BLANK">W</a> abrégé <strong><em class="sigle">TAI</em></strong>  est une échelle de temps <strong class="defin">purement périodique</strong>, aux défauts techniques impondérables près. </p>

<p> Elle est établie par le <strong>bureau international des poids et mesures</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Bureau_international_des_poids_et_mesures" target="_BLANK">W</a> (<strong><em class="sigle">BIPM</em></strong>) qui publie régulièrement un <strong class="pros">tableau correctif rétrospectif</strong> des valeurs fournies par les <strong class="defin">compteurs incrémentaux</strong>. </p>

<p> Ces <strong class="pros">corrections</strong> sont calculées par <strong>moyennes pondérées</strong> de l'échelle de temps générées par <strong>plus de 500 horloges atomiques</strong> réparties dans le monde. </p>
</div><!-- important -->


<h3 id="jourSolaire"> Le jour solaire : un phénomène de durée variable </h3>



<div class="important" style="display: inline-block;">
	<img class="top-right" src="../img/meridien.png" width="250px" style="padding-top: 0.3em;">
<p> On peut définir intuitivement le <strong class="title">jour solaire</strong> <a class="external" href="Rc2-6_serviceTemps.html" target="_BLANK">W</a> comme la durée supposée périodique entre <strong class="defin">deux passages consécutifs du Soleil</strong> dans le <strong>plan méridien</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Plan_méridien" target="_BLANK">W</a> d'un même lieu terrestre, principalement (mais pas seulement…) du fait de la rotation de la terre sur elle‑même. </p>

<p> Avec des moyens de mesure rudimentaires (une horloge du commerce), on peut constater sans difficulté que cette <strong>durée</strong> n'a <strong class="cons">pas de valeur constante</strong> tout au long de l'année. </p>
</div><!-- important -->

<div class="complement">
<p> Les <strong class="title">variations</strong> du <strong>jour solaire</strong> sont principalement causées par des <strong class="defin">facteurs astronomiques</strong> qui s'accentuent ou se compensent mutuellement au cours d'un cycle annuel. L'amplitude de ces variations autour d'une valeur moyenne s'inscrit dans un <strong>intervalle</strong> d'environ <em class="bold">−21</em> à <em class="bold">+30 s</em>. </p>

<p> Si l'on établit une échelle de temps basée sur le jour solaire, dite <strong class="title">temps solaire vrai</strong>, il en résulte des <strong class="warning">variations cumulées</strong> sur une année d'environ <em class="bold">−16</em> à <em class="bold">+14 min</em> par rapport à une échelle de temps à jour de durée fixe comme le <strong><em class="sigle">TAI</em></strong>. La courbe représentative de ces variations obéit à ce qu'on appelle l'<strong class="defin">équation du temps</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Équation_du_temps" target="_BLANK">W</a>. </p>
</div><!-- complement -->

<div class="expert"> 
<p class="square" > Pour bien comprendre les multiples facteurs qui impactent la <strong class="defin">durée du jour solaire</strong>, rappelons déjà qu'il faut <strong class="warning">ne pas confondre</strong> cette notion avec celle de <strong class="title" style="color: dodgerblue;">jour sidéral</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Jour_sidéral" target="_BLANK">W</a> qui est la durée de rotation de la Terre sur elle‑même lorsqu'elle est considérée dans un <strong class="specialN">repère stellaire</strong> – d'où le terme « sidéral » <a class="external" href="https://fr.wiktionary.org/wiki/sidéral" target="_BLANK">W</a>. Cette durée peut être précisément mesurée par chronométrage de deux passages successifs d'une <strong class="specialLY">étoile lointaine</strong> dans un système de visée fixe sur Terre ; elle vaut environ <strong class="title" style="color: dodgerblue;">23 heures 56 minutes</strong>. </p>

<p> Pour terminer un <strong class="defin">jour solaire</strong> complet, il faut qu'un point pris comme référence à la surface terrestre se retrouve exactement face au Soleil. Or, en même temps qu'elle tourne sur elle‑même, la Terre se déplace selon sa <strong class="specialGr">trajectoire orbitale</strong> dans sa révolution autour du Soleil. Elle doit donc effectuer sur elle‑même une rotation d'angle supérieure à 360° pour que son point pris comme référence se retrouve dans l'<strong class="specialGr">axe solaire</strong> (cf. la figure ci‑dessous qui, bien évidemment, n'est pas à l'échelle). Le temps nécessaire pour accomplir ce <strong>surcroît de rotation</strong> est d'<strong class="specialO">environ 4 minutes</strong> (soit environ +0,3 % par rapport au jour sidéral). Il en résulte que le <strong class="defin">jour solaire</strong> dure approximativement <strong class="defin">24 heures</strong>.  </p>

<img class="top-left" src="../img/jourSolaireSideral.png" style="max-width: 1000px;">

<p> (Bien évidemment, le fait qu'un jour solaire dure 24 heures ne doit rien au hasard, puisqu'en fait, l'heure est implicitement définie comme la durée égale à 1/24<sup>e</sup> du jour solaire – cf. infra.) </p>


<p class="square"> Mais de plus, il faut aussi tenir compte de l'<strong class="title">excentricité de l'orbite terrestre</strong> autour du Soleil. Même si cette excentricité est assez faible, elle impacte quand même la <strong class="defin">vitesse de la Terre</strong> sur sa trajectoire orbitale – le phénomène ayant une <strong>période annuelle</strong>. </p>

<img class="top-left" src="../img/orbiteTerrestre.png" width="400px" style="width: 600px;">
<!-- refaire cette figure -->

<p>	En effet <a class="external" href="https://fr.wikipedia.org/wiki/Équation_du_temps#Influence_de_l'ellipticité_de_l'orbite_de_la_Terre" target="_BLANK">W</a> : </p>
<ul>
	<li> au voisinage du <strong class="specialLB">périhélie</strong>, la plus grande proximité du Soleil induit sur la Terre une accélération radiale plus forte, donc une <strong class="defin">vitesse plus élevée</strong>, donc une trajectoire parcourue plus grande, donc un <strong>supplément de rotation plus grand</strong>, donc un <strong class="cons">jour solaire plus long</strong> que la moyenne.   </li>

	<li> Et au voisinage de l'<strong class="specialLB">aphélie</strong>, c'est l'inverse : la Terre a une <strong class="defin">vitesse plus lente</strong>, donc un <strong class="cons">jour solaire plus court</strong> que la moyenne.  </li>
</ul>


<p class="square"> Par ailleurs, l'<strong class="title">inclinaison de l'axe de rotation</strong> de la Terre par rapport au plan de l'écliptique induit également une <strong class="cons">variation du jour solaire</strong>, mais selon une <strong>période semestrielle</strong> : il augmente « autour » des solstices et diminue « autour » des équinoxes <a class="external" href="https://fr.wikipedia.org/wiki/Équation_du_temps#Influence_de_l'obliquité_de_la_Terre" target="_BLANK">W</a>. </p> 
</div><!-- expert -->


<h4 id="jourSolaireMoyen"> Le jour solaire moyen </h4>


<div class="complement">
<p> Au regard des variations périodiques du jour solaire, il a été jugé commode à la fin du <em class="sigle">XIX</em><sup>e</sup> siècle de prendre le <strong class="title">jour solaire moyen</strong> – c'est‑à‑dire sa <strong class="defin">moyenne annuelle</strong> – comme <strong>principale unité de temps</strong>. </p>

<p> La <strong class="specialLB">seconde</strong> était alors déterminée comme valant exactement un <em class="bold">86&#8239;400<sup>e</sup></em> du jour solaire moyen et l'<strong class="specialLB">heure</strong> comme 3600 secondes, donc <em class="bold">1/24<sup>e</sup></em> du jour solaire moyen. </p>
</div><!-- complement -->

<p> Toutefois, cette définition s'est révélée quand même <strong class="warning">insatisfaisante</strong> en raison de multiples facteurs. </p>
<ul>
	<li> D'abord, encore fallait‑il préciser la <strong class="specialLB">durée d'une année</strong> pour calculer la moyenne ; on verra infra que c'est la notion d'<strong>année tropique</strong> qui a été retenue. </li>

	<li> Mais surtout, il est apparu que même le <strong class="title">jour solaire</strong> <strong class="specialDB">moyen</strong> n'est <strong class="cons">pas constant</strong> d'une année sur l'autre. De nombreux phénomènes astronomiques et géologiques engendrent des perturbations de la fréquence de rotation de la Terre ainsi que sa vitesse orbitale.   </li>

	<div class="expert">
	<ul>
		<div style="display: inline-block;">
			<img class="top-right" src="../img/luneMaree.jpg" width="200px" style="padding-top: 0.5em;">
		<li> Il y a l'<strong>influence gravitationnelle</strong> de la <strong class="specialO">Lune</strong> qui provoque les <strong>marées</strong>, mais aussi les écoulements des masses atmosphériques (air, eau), les mouvements de la croûte (tectonique des plaques), du magma interne et du noyau liquide. Tous les phénomènes dissipent de l'énergie mécanique et <strong class="cons">modifient</strong> le <strong class="specialN">moment d'inertie</strong> de la planète. </li>
	  </div><!-- display -->

		<li> Il y a même l'influence d'<strong class="specialO">autres planètes</strong> du système solaire qui, selon leur proximité ou leur éloignement avec la Terre, modifient son accélération. </li>
	</ul>
  </div><!-- expert -->
</ul>
<p> Certains de ces facteurs sont <strong class="cons">imprévisibles</strong>. Mais sur le très long terme – depuis le tout début de l'histoire de la Terre – on constate un <strong class="warning">ralentissement</strong>, c'est‑à‑dire une <strong class="title">augmentation de la période de rotation de la Terre</strong>, actuellement de l'ordre de 1,3 ms/j, soit <em class="bold">1 s/ 800 j</em> environ. </p>

<div class="remarques"><p class="remarques"></p>
	<div style="display: inline-block;">
	<img class="top-right" src="../img/corauxDevonien.jpg" width="200px" style="padding-top: 0.0em;">
<ol class="littered">
	<li> Pour se faire une idée du <strong class="warning">ralentissement</strong> de la rotation de la Terre sur elle‑même, on estime qu'à l'époque du <strong>Dévonien</strong>, c'est‑à‑dire il y a environ 380 Ma <a class="external" href="https://fr.wikipedia.org/wiki/Rotation_de_la_Terre#Traces_paléontologiques_du_ralentissement_de_la_rotation_terrestre" target="_BLANK">W</a> : </li>
	<ul>
		<li> un <strong class="specialLB">jour terrestre</strong> durait <strong>environ 22 h</strong> ;  </li>

		<li> et une <strong class="specialLB">année</strong> environ <strong>400 de ces jours</strong>. </li>
	</ul> 

	<li> Et néanmoins, <strong>depuis 2020</strong>, on observe plutôt une <strong class="warning">stabilisation</strong> de la vitesse de rotation de la Terre sur elle‑même (cf. infra <a class="infra" href="Rc2-6_serviceTemps.html#accelerationRotationTerre"></a>) – mais il s'agit vraisemblablement d'un épiphénomène.  </li>
</ol>

</div><!-- display -->
</div><!-- remarque -->



<h3 id="anneeTropique"> L'année tropique : période du cycle des saisons </h3>


<h4> L'année sidérale et l'année tropique </h4>


<p> Comme pour la notion de jour, la <strong class="title">notion d'année</strong> se décline en <strong>deux sous‑notions</strong> détaillées ci‑dessous  </p>
<ul>
	<li> L'<strong class="specialLB">année sidérale</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Année_sidérale" target="_BLANK">W</a> qui est la durée supposée périodique de <strong class="defin">révolution de la Terre</strong> autour du Soleil, lorsqu'elle est observée <strong>par rapport aux étoiles</strong>. Elle vaut en moyenne 365,25636042 jours solaires moyens. </li>

	<li> L'<strong class="specialLB">année tropique</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Année_tropique" target="_BLANK">W</a> qui est concrètement la durée supposée périodique d'un <strong class="defin">cycle des quatre saisons</strong>, en considérant comme référence de répétition l'<strong>équinoxe de printemps de l'hémisphère nord</strong>. Elle vaut en moyenne 365,2421898 jours solaires moyens. </li>
  
  <div class="expert">
	<div class="nobullet"> En fait, la définition de l'<strong class="specialLB">année tropique</strong> est <strong class="cons">plus complexe</strong> : c'est la durée moyenne entre deux passages consécutifs du soleil au même point dans son orbite apparente vue depuis la Terre (ce qu'on appelle le cercle écliptique sur la voûte céleste). La définition qui est donnée ci‑dessus correspond en fait à ce qu'on nomme l'<strong>année vernale</strong> (qui a la même durée que l'année tropique). </div>
  </div><!-- expert -->
</ul>

<p> Une <strong class="title">année tropique</strong> est donc <strong class="defin">plus courte</strong> qu'une <strong class="specialLB">année sidérale</strong> d'environ année 0,01417062 jour, soit 1224,341568 s, autrement dit approximativement <em class="bold">20 min et 24 s</em>.  </p>


<div class="expert">
<h4> Un phénomène : la précession des équinoxes </h4>


<div style="display: inline-block;">
	<img class="top-right" src="../img/precessionEquinoxes.jpg" width="400px" >
<p>	La <strong>différence entre les deux notions</strong> d'année sidérale et d'année tropique résulte principalement d'un phénomène appelé – par relation de cause à effet – la <strong class="title">précession des équinoxes</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Précession_des_équinoxes" target="_BLANK">W</a>. C'est ainsi qu'on appelle le mouvement d'<strong class="defin">oscillation de l'axe de rotation de la Terre</strong> – à la manière d'une toupie, mais très lentement puisque la période de cette oscillation est d'environ 25&#8239;800 ans. </p>

<p> Ainsi, à la moitié de cette période (donc, tous les 12&#8239;900 ans), l'angle que présente l'axe de rotation de la Terre avec la normale au plan de l’écliptique prend une valeur opposée à celle qu'il avait au début de la période. Par exemple : </p>
<ul>
	<li> à notre époque, le <strong>solstice d'hiver</strong> de l'hémisphère nord se produit lorsque la Terre est voisine de son <strong class="specialLB">périhélie</strong> ; </li>

	<li> mais dans environ 12&#8239;900 ans, c'est le <strong>solstice d'été</strong> qui se produira au voisinage du périhélie ! </li>
</ul>
<p> Ce phénomène <strong class="cons">pourrait sembler négligeable</strong> tant sa période est grande à l'échelle de l'histoire contemporaine. Et pourtant, il est identifié comme <strong class="warning">problématique</strong> depuis Hipparque (<em class="sigle">I</em><sup>e</sup> siècle avant J.‑C. <a class="external" href="https://fr.wikipedia.org/wiki/Hipparque_(astronome)" target="_BLANK">W</a>) ! Et en effet, par la <strong>différence  de durée</strong> entre l'année sidérale et l'année tropique, <em class="remark">à chaque siècle</em>, les solstices et équinoxes se décalent de plus d'une journée dans l'année sidérale. C'est ce qu'on appelle la <strong class="defin">dérive séculaire des saisons</strong>.  </p>
</div><!-- display -->
</div><!-- expert -->


<h4> Choix de l'année tropique pour les calendriers civils </h4>


<div class="important">
<p> Afin d'éviter une lente dérive des saisons, c'est donc l'<strong class="title">année tropique</strong> qui a été retenue comme <strong>durée de référence</strong> pour établir les <strong class="defin">calendriers civils</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Calendrier_civil" target="_BLANK">W</a>. </p>
</div><!-- important -->

<div class="expert">
<p> Ainsi, le <strong class="title">calendrier Julien</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Calendrier_julien" target="_BLANK"></a> – appelé ainsi car imposé par Jules César en l'an 46 avant J.‑C. – avait déjà introduit la notion d'<strong class="defin">année bissextile</strong> : <em class="remark">toutes les 4 années</em>, un <strong>jour supplémentaire</strong> était ajouté au mois de <strong>février</strong> (le 29), portant la durée moyenne de l'<strong class="specialLB">année julienne</strong> à 365,25 jours. </p>

<p> Mais sachant la durée réelle de l'année tropique (environ 365,242 jours), cette règle n'était pas adéquate : l'année julienne ainsi définie était encore <strong class="warning">trop longue</strong> d'environ <em class="bold">11 min et 14 s</em>. Il en résultait <strong class="cons">encore une dérive non négligeable</strong> des équinoxes et des solstices (un jour tous les 128 ans), qui fut constatée dès le III<sup>e</sup> siècle. </p>
</div><!-- expert -->

<div class="complement">
<p> Et c'est seulement depuis l'adoption du <strong>calendrier grégorien</strong> que la durée de l'année civile est pratiquement égale à celle de l'année tropique. </p>
</div><!-- complement -->


<h4> Le calendrier grégorien </h4>


<div class="important">
<p> Le <strong class="title">calendrier grégorien</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Calendrier_grégorien" target="_BLANK">W</a> est un <strong class="defin">calendrier solaire</strong> – autrement dit, un système de numérotation des jours solaires. Il a conçu au début du <strong><em class="sigle">XVI</em><sup>e</sup> siècle</strong> à la demande du pape Grégoire <em class="sigle">XIII</em> pour <strong class="pros">mieux corriger la dérive des solstices</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Calendrier_grégorien#La_raison_du_changement_:_le_problème_du_comput" target="_BLANK">W</a> que le <strong>calendrier julien</strong>.  </p>

<p> Il est <strong class="pros">adopté</strong> par la <strong>quasi‑totalité des états du monde</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Passage_du_calendrier_julien_au_calendrier_grégorien" target="_BLANK">W</a> (dès 1582 par les pays catholiques comme la France).   </p>
</div><!-- important -->


<div style="display: inline-block;">
	<img class="top-right" src="../img/leapDay.jpg" width="180px">
<p> Dans le <strong class="title">calendrier grégorien</strong>, l'<strong class="defin">année commune</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Année_commune" target="_BLANK">W</a> compte <em class="bold">365 j</em>. Et, comme dans le calendrier julien, si le numéro d'année est <strong>divisible par 4</strong>, on ajoute un <strong class="specialO">jour intercalaire</strong> (en anglais, <em class="english">leap day</em>) – le 29 février – et on parle alors d'<strong class="specialO">année bissextile</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Année_bissextile" target="_BLANK">W</a> (en anglais, <em class="english">leap year</em>). </p>

<p> Or cet ajustement n'est <strong class="cons">pas suffisant</strong> puisque, en nombres de jours, la partie fractionnaire de l'année tropique est légèrement inférieure à ¼. En conséquence : </p>
<ul>
	<li> les <strong class="specialLB">années</strong> dont le numéro est <strong>divisible par 100</strong> (donc par 4) font exception à la règle générale ; elles sont donc considérées comme <strong class="defin">commune</strong> et non pas bissextiles ; </li>

	<li> mais les <strong class="specialLB">années</strong> dont le numéro est <strong>divisible par 400</strong> (donc par 100) font exception à la règle supra ; elles sont bel et bien considérées comme <strong class="specialO">bissextiles</strong> et non pas communes. </li>
</ul>
</div><!-- display -->

<div class="expert">
<p> Cette solution ajuste la <strong>valeur moyenne</strong> de l'<strong class="specialT">année calendaire</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Année_(calendrier)" target="_BLANK">W</a> à <em class="bold">365,2425 j</em>. La différence avec la valeur moyenne de l'année tropique (pour mémoire, environ 365,2422 jours) induit une  <strong class="cons">dérive des saisons</strong> <strong class="pros">très lente</strong> – environ <strong>3 jours tous les 10 000 ans</strong> – qui n'est pas considéré comme un problème aujourd'hui… </p>

<p> Par ailleurs, il faut aussi prendre en compte le ralentissement de la rotation de la Terre sur elle‑même qui aura tendance à accentuer cet écart. </p>

<p> Enfin, il ne faut pas perdre de vue que l'<strong>année tropique</strong> elle‑même n'a <strong class="cons">pas une durée constante</strong>. Perturbée par la présence des autres planètes du système solaire, elle a tendance diminuer de 0,5 s par siècle…</p>
</div><!-- expert -->



<h3 id="tempsUniversel"> Le temps universel </h3>


<div class="important">
<p> Le <strong class="title">temps universel</strong>, abrégé <strong><em class="sigle">UT1</em></strong>, est une <strong class="defin">échelle de temps solaire</strong> basée sur le <strong>chronométrage</strong> au regard d'une échelle du temps atomique : </p>
<ul>
	<li> de la <strong>rotation</strong> de la Terre sur elle‑même – ce qui permet de déterminer la durée moyenne du <strong class="defin">jour solaire</strong> ; </li>

	<li> et de la <strong>révolution</strong> de la Terre autour du soleil au sens de l'<strong class="defin">année tropique</strong> ; </li>	
</ul>
<p> On procède par l'<strong>observation d'objets célestes</strong> très distants – des quasars <a class="external" href="https://fr.wikipedia.org/wiki/Quasar" target="_BLANK">W</a> – et l'emploi de <strong>techniques d'interférométrie</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Interférométrie_à_très_longue_base" target="_BLANK">W</a>. </p>
</div><!-- important -->




<div class="complement">
<p> Le <strong class="title">temps universel</strong> <strong><em class="sigle">UT1</em></strong> reprend les mêmes principes, mais avec des <strong class="pros">mesures plus précises</strong>, que <strong class="specialLB">temps moyen de Greenwich</strong> – <strong>Greenwich mean time</strong>, abrégé <strong><em class="sigle">GMT</em></strong> – largement adoptée dans le monde au début du <em class="sigle">XX</em><sup>e</sup> siècle <a class="external" href="https://fr.wikipedia.org/wiki/Temps_moyen_de_Greenwich" target="_BLANK">W</a>. </p>
</div><!-- complement -->

<p> <em class="remark">Attention</em>. La <strong class="specialLB">seconde</strong> du <strong class="title">temps universel</strong> n'a <strong class="warning">pas exactement</strong> (mais presque) la même durée que celle du <strong>temps atomique</strong>. Elle est définie comme un <em class="bold">86&#8239;400<sup>e</sup></em> du <strong class="defin">jour solaire terrestre moyen</strong>, dont la durée est calculée sur la base des chronométrages effectués par le <strong>Service international de la rotation terrestre et des systèmes de référence</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Service_international_de_la_rotation_terrestre_et_des_systèmes_de_référence" target="_BLANK">W</a> – en anglais, <em class="english">International Earth rotation and reference systems service</em> ou <strong><em class="sigle">IERS</em></strong>. </p>

<p> Il en résulte un <strong class="title">décalage</strong> par rapport au <strong class="specialLB">temps atomique international</strong> (cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#tempsAtomique"></a>) de <strong class="warning">quelques secondes</strong> sur une cinquantaine d'années. On va voir que ce décalage est à l'origine de la définition du <strong>temps universel coordonné</strong> ou <strong><em class="sigle">UTC</em></strong> (cf. infra <a class="infra" href="Rc2-6_serviceTemps.html#UTC"></a>). </p>



<h3 id="zoneHoraire"> Les zones horaires : définition du temps mondial </h3>



<div class="important">
<p> Dans chaque pays, quelle que soit l'échelle de temps adoptée, l'<strong class="title">heure officielle</strong> – et donc aussi la <strong class="title">date</strong> – est <strong class="defin">décalée</strong> par rapport à l'<strong class="specialO">heure internationale</strong> (cf. infra), au regard de sa <strong>position géographique</strong> et de <strong>choix politiques</strong>. </p>

<p> Ce décalage, spécifique à telle ou tel lieu géographique, permet aux horaires remarquables <em class="bold">0 h</em> – <em>minuit</em> – et <em class="bold">12 h</em> – <em>midi</em> – de correspondre partout sur Terre (sauf aux latitudes extrêmes) à la <strong class="pros">même réalité solaire</strong>, c'est‑à‑dire respectivement au milieu du jour et de la nuit . </p>
</div><!-- important -->


<p> Lors de la Conférence internationale de Washington <a class="external" href="https://fr.wikipedia.org/wiki/Conférence_internationale_de_Washington_de_1884" target="_BLANK">W</a> (1884), le <strong class="title">méridien de Greenwich</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Méridien_de_Greenwich" target="_BLANK">W</a> – du nom d'un quartier de Londres où se situe l'Observatoire Royal – a été adopté comme <strong>méridien de référence</strong> pour définir l'<strong class="specialO">heure internationale</strong>. Il sert également à diviser le globe terrestre en deux hémisphères dits <em>Ouest</em> et <em>Est</em>. </p>

<p> Quant aux anciens <strong class="title">fuseaux horaires</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Fuseau_horaire" target="_BLANK">W</a>, ils sont issus d'une division historique du globe en <strong class="defin">24 secteurs angulaires réguliers de 15°</strong> dont l'un est <strong>centré sur le méridien de Greenwich</strong>. </p> 

<div class="complement">
<p> Aujourd'hui, on ne parle plus de fuseaux mais de <strong class="title">zones horaires</strong> <a class="external" href="https://en.wikipedia.org/wiki/Time_zone" target="_BLANK">W</a> – en anglais, <strong>time zone</strong> car leur découpage est <strong class="warning">plus complexe</strong> : </p>
	<img class="top-left" src="../img/timeZones.jpg" style="max-width: 600px">
<ul>
	<li> sur la carte mondiale <a class="external" href="https://fr.wikipedia.org/wiki/Liste_des_fuseaux_horaires" target="_BLANK">W</a>, on distingue bien 24 grandes zones horaires qui sont chacune étiquetée par un <strong class="title">décalage horaire</strong> <strong class="defin">entier</strong> positif ou négatif ; </li>

	<li> mais la zone la plus à droite se divise en deux, étiquetées respectivement <em class="bold">+12</em> et <em class="bold">−12</em> ; </li>

	<li> et même, à l'extrême gauche, on observe deux petites zones étiquetées <em class="bold">+13</em> et <em class="bold">+14</em> ! </li>

	<li> enfin, certains pays (par exemple, l'Inde…) adoptent un <strong class="specialO">décalage horaire fractionnaire</strong> – c'est‑à‑dire qui ne s'exprime pas par un nombre entier d'heures, la résolution autorisée étant de <strong>15 minutes</strong>. </li>
</ul>
</div><!-- complement -->

<div class="expert">
<p> Pour <strong class="title">approfondir</strong> ces aspects, on pourra consulter la vidéo de la chaîne <em class="mark">YouTube</em> de vulgarisation historique et géographique <strong>TéléCrayon</strong> au lien suivant <a class="external" href="https://www.youtube.com/watch?v=SMd19wANF3Y" target="_BLANK">Y</a>. </p>
</div><!-- expert -->


<h4> Désignation des zones horaires </h4>


<div class="important">
<p> Toute <strong class="title">zone horaire</strong> peut être désignée par une <strong class="defin">chaîne de caractères</strong> de la forme <span class="framed" style="background: white"><code>UTC<strong class="specialO">±</strong><span class="nocode"><strong class="specialO">hh</strong></span>:<span class="nocode"><strong class="specialO">mm</strong></span></code></span> où : </p>
<ul>
	<li> le sigle <code class="cmd">UTC</code> fait référence à l'échelle du <strong>temps universel coordonné</strong> mondialement adopté pour l'heure internationale (cf. infra <a class="infra" href="Rc2-6_serviceTemps.html#UTC"></a>) ;  </li>

	<li> la forme <code class="cmd"><span class="nocode"><strong class="specialO">hh</strong></span>:<span class="nocode"><strong class="specialO">mm</strong></span></code> représente les <strong>digits du décalage horaire</strong> par rapport à l'heure internationale, chiffré à <strong>15 min</strong> près ;  </li>

	<li> le <strong>sens</strong> du décalage est spécifié par un <strong>signe</strong> <code class="cmd"><strong class="specialO">+</strong></code> ou <code class="cmd"><strong class="specialO">−</strong></code> </li>
</ul>
</div><!-- important -->

<div class="complement">
<p> Lorsque le décalage s'exprime en <strong>heures pleines</strong> (sans minutes), on adopte une <strong class="specialLB">écriture simplifiée</strong> de la forme <span class="framed" style="background: white"><code>UTC<strong class="specialO">±</strong><span class="nocode"><strong class="specialO">h</strong></span></span></code></span> où <strong class="specialO">h</strong> représente le <strong>nombre d'heures</strong> du décalage. <em class="remark">Exemple</em> : on écrit simplement <code class="cmd">UTC+2</code> pour indiquer la zone horaire dite d'Europe de l'est. </p>

<p> De plus, on peut <strong class="specialLB">omettre</strong> l'indication du décalage lorsqu'il est <strong>nul</strong>. Ainsi, la zone horaire d'Europe de l'Ouest <code class="cmd">UTC+0</code> se note <strong class="pros">tout simplement</strong> <code class="cmd">UTC</code> (elle était anciennement désignée <code>GMT</code>). </p>
</div><!-- complement -->

<div class="expert" style="display: inline-block;">
<p> Pour faciliter les traitements informatiques, <strong>certaines</strong> <strong class="title">zones horaires</strong> sont également désignées par un voire plusieurs <strong class="specialLB">sigles</strong> comme illustré ci‑dessous. </p>
  <img class="top-left" src="../img/EuropeTimeZones.png" style="max-width: 800px">
<p> Par exemple : </p>
<ul>
	<li> <strong class="specialLB"><em class="sigle">WET</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/Heure_d'Europe_de_l'Ouest" target="_BLANK">W</a> pour <strong>Western European Time</strong> – anciennement <em class="english">Greenwich mean time</em> ou <strong><em class="sigle">GMT</em></strong> – qui correspond à <strong class="defin"><em class="sigle">UTC+0</em></strong> ; </li>

	<li> <strong class="specialLB"><em class="sigle">CET</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/Heure_normale_d'Europe_centrale" target="_BLANK">W</a> pour <strong>Central European Time</strong> ou <strong class="specialLB"><em class="sigle">WAT</em></strong> pour <strong>West Africa Time</strong> qui correspondent l'une et l'autre à <strong class="defin"><em class="sigle">UTC+1</em></strong> ; </li>

	<li> <strong class="specialLB"><em class="sigle">EET</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/Heure_normale_d'Europe_de_l'Est" target="_BLANK">W</a> pour <strong>Eastern European Time</strong> ou <strong class="specialLB"><em class="sigle">CAT</em></strong> pour <strong>Central Africa Time</strong> qui correspondent l'une et l'autre à <strong class="defin"><em class="sigle">UTC+2</em></strong> ; etc. </li>
</ul>
</div><!-- expert -->

<div class="remarques">
<p class="remarque"> Selon sa position géographique, un <strong class="title">pays</strong> peut <strong>hésiter entre deux zones horaires voisines</strong> pour de nombreuses raisons <a class="external" href="https://fr.wikipedia.org/wiki/Fuseau_horaire#Modifications" target="_BLANK">W</a>, notamment politiques. Mais le choix effectué n'est <strong class="defin">jamais indifférent</strong> en termes de décalage avec le temps solaire <a class="external" href="https://fr.wikipedia.org/wiki/Fuseau_horaire#/media/Fichier:Solar_time_vs_standard_time.png" target="_BLANK">W</a>. </p>
</div><!-- remarque -->



<h3 id="DST"> L'heure d'« été » </h3>



<div class="expert">
<p> La possibilité pour un pays d'adopter un <strong class="title">décalage horaire au quart d'heure près</strong> <strong class="warning">ne suffit pas</strong> à optimiser la <strong class="defin">superposition</strong> des <strong>horaires d'activité</strong> avec les <strong>horaires solaires</strong>, et ce d'autant plus que ce pays est situé à des latitudes élevées, c'est‑à‑dire avec des <strong class="cons">saisons contrastées</strong>. </p>

<p> Une <strong class="title">mauvaise superposition</strong> a tendance à occasionner une <strong class="warning">surconsommation énergétique</strong>, en particulier pour l'éclairage en soirée. </p>
</div><!-- expert -->

<div class="important" style="display: inline-block;">
	<img class="top-right" src="../img/DST.png" height="200px">
<p> Le décalage dit d'<strong class="title">heure d'été</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Heure_d'été" target="_BLANK">W</a>  – en anglais, <strong>daylight saving time</strong> ou <em class="bold"><em class="sigle">DST</em></em> – consiste à <strong class="defin">augmenter d'une heure</strong> le <strong>décalage horaire</strong> établi dans une zone horaire durant une <strong class="specialLB">période dite estivale</strong> (<em class="english">summer time</em>) au sens large. Hors de cette période, on parle d'<strong>heure standard</strong> (<em class="english">standard time</em>) ou encore d'<em>heure d'hiver</em>. </p>

<p> Il en résulte que : </p>
<ul>
	<li> le <strong>jour de passage</strong> à l'<strong class="title">heure d'été</strong> dure <em class="bold">23 h</em> ;  </li>

	<li> le <strong>jour de retour</strong> à l'<strong class="title">heure d'hiver</strong> dure <em class="bold">25 h</em>.  </li>
</ul>
</div><!-- important -->

<div class="complement">
<p> Comme le choix de la zone horaire, l'<strong class="title">adoption</strong> ou nom du <strong class="title">décalage d'heure d'été</strong> est en principe une <strong class="defin">décision politique</strong>, souveraine ou éventuellement supra‑nationale (c'est précisément le cas au sein de l'Union Européenne). </p>

<p> De plus, les <strong class="title">jours et horaires de passages</strong> ne sont pas <strong class="cons">pas harmonisée</strong> au niveau mondial. Leurs choix sont également le fruit de décisions politiques locales. </p>

<ul>
	<li> En particulier, les <strong class="specialLB">jours de passage</strong> sont fixés par des <strong>contraintes calendaires</strong> complexes – par exemple, le « <em>dernier dimanche du mois de mars</em> » pour le passage à l'heure d'été et le « <em>dernier dimanche du mois d'octobre</em> » pour le retour à l'heure d'hiver. </li>

	<li> Quant aux <strong class="specialLB">heures de transition</strong>, elles sont en général fixées la nuit, typiquement entre <code>01:00</code> et <code>03:00</code> heures du matin.   </li>
</ul>
</div><!-- complement -->


<div class="expert">
<p> Pour faciliter les traitements informatiques, les <strong class="title">zones horaires</strong> où le <strong>décalage d'heure d'été</strong> est <strong class="defin">en vigueur</strong> sont désignés par des <strong class="specialLB">sigles spécifiques</strong>. Par exemple : </p>
<ul>
	<li> <strong class="specialLB"><em class="sigle">WEST</em></strong> pour <strong>Western European Summer Time</strong> qui correspond à <strong class="defin"><em class="sigle">UTC+1</em></strong> ; </li>

	<li> <strong class="specialLB"><em class="sigle">CEST</em></strong> pour <strong>Central European Summer Time</strong> qui correspond à <strong class="defin"><em class="sigle">UTC+2</em></strong> ; etc. </li>
</ul>


<div class="exemples">
<p class="exemple"> Dans toutes les zones horaires de l'<strong>Union Européenne</strong>, les <strong class="title">règles de changement d'heure</strong> sont <strong class="pros">harmonisées</strong> (cf. la carte ci‑dessous, actualisée en 2017) : </p>
	<img class="top-left" src="../img/tzmap-europe-2017.png" style="max-width: 800px">
<ul>
	<li> Le <strong class="specialLB">passage à l'heure d'été</strong> intervient le <strong>dernier dimanche</strong> du mois de <strong>mars</strong> à <code>01:00:00 UTC</code>.  </li>

	<div class="nobullet"> Autrement dit, juste après <code>00:59:59</code>, l'heure officielle est <code>02:00:00</code>. </div>

	<li> Le <strong class="specialLB">passage à l'heure d'hiver</strong> intervient le <strong>dernier dimanche</strong> du mois de <strong>octobre</strong> à <code>02:00:00 UTC</code>.  </li>

	<div class="nobullet"> Autrement dit, juste après <code>01:59:59</code>, l'heure officielle est <code>01:00:00</code>. </div>
</ul>
<p> Chaque changement d'heure se déroule <strong class="defin">au même instant</strong> <strong>quelle que soit la zone horaire</strong>, donc avec une ou deux heures de décalage par rapport à l'heure locale. Ainsi, dans la zone horaire d'Europe centrale (<strong><em class="sigle">CET</em></strong>) :  </p>
<ul>
	<li> le <strong class="specialLB">passage à l'heure d'été</strong> intervient à <code>02:00:00 CET</code> qui devient <code>03:00:00 CEST</code> (<em class="english">Central European Summer Time</em>) ;  </li>

	<li> le <strong class="specialLB">passage à l'heure d'hiver</strong> intervient à <code>03:00:00 CEST</code> qui redevient <code>02:00:00 CET</code> (<em class="english">Central European Time</em>). </li>
</ul>
</div><!-- exemple -->
</div><!-- expert -->




<div class="remarques">
<p class="remarque"> Le 26 mars 2019, le <strong>Parlement européen</strong> a voté un <strong>projet de directive</strong> d'<strong class="title">abandon des changements d'heure</strong>, conformément au résultat d'une consultation populaire menée par la <strong>Commission européenne</strong> <a class="external" href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX%3A52018SC0406" target="_BLANK"></a>. </p>

<p> Toutefois, cette décision n'a <strong class="warning">pas encore été validée</strong> par le <strong>Conseil de l'Europe</strong> — étape indispensable avant la mise en application de cette décision. De plus, ce sujet ne figure <strong class="cons">pas encore sur l'agenda</strong> du Conseil <a class="external" href="https://www.numerama.com/sciences/1164156-la-fin-du-changement-dheure-en-europe-toujours-pas-pour-2022.html" target="_BLANK"></a>. </p>

<p> Pour un technicien en informatique, il reste donc indispensable de <strong class="pros">savoir gérer ce dispositif</strong> qui va vraisemblablement perdurer encore au moins quelques années. </p>
</div><!-- remarques -->



<h3 id="UTC"> Le temps universel coordonné </h3>



<div class="important">
<p>  Le <strong class="title">temps universel coordonné</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Temps_universel_coordonné" target="_BLANK">W</a> – <em class="english">coordinated universal time</em> ou <strong><em class="sigle">UTC</em></strong> – est une échelle de temps en vigueur depuis le 1<sup>er</sup> janvier 1972. </p>

<p> L'<strong class="title"><em class="sigle">UTC</em></strong> est basé sur le <strong>temps atomique international</strong> (<strong><em class="sigle">TAI</em></strong>) avec un <strong class="defin">retard initial</strong> de <strong class="defin">10 secondes</strong> pour corriger le décalage accumulé avec l'échelle de <strong>temps universel <em class="sigle">UT1</em></strong>. </p>

<p> De plus, il est désormais sporadiquement ajusté par incrémentation ou décrémentation unitaire d'une <strong class="specialY">seconde intercalaire</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Seconde_intercalaire" target="_BLANK">W</a> (en anglais, <strong>leap second</strong>) chaque fois que nécessaire pour garantir un <strong class="pros">écart toujours inférieur</strong> à <em class="bold">±0,9 s</em> avec le <strong>temps universel <em class="sigle">UT1</em></strong>. </p>

<p> L'<strong class="title"><em class="sigle">UTC</em></strong> est aujourd'hui adopté dans tous les pays développés comme <strong class="defin">échelle du temps officiel</strong>, aux décalages de zones et d'heure d'été près. </p>
</div><!-- important -->

<div class="complement" id="leapSeconds">
<p> C'est l'<em class="bold"><em class="sigle">IERS</em></em> (cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#tempsUniversel"></a>) qui prend la <strong class="title">décision</strong> d'ajouter ou retrancher une <strong class="specialY">seconde intercalaire</strong> au compteur de secondes de l'<em class="bold"><em class="sigle">UTC</em></em>, et ce au regard de la mesure du <strong>temps universel <em class="sigle">UT1</em></strong> dont il a la responsabilité.  </p>

<p> En principe, une telle modification : </p>

<ul>
	<li> ne peut intervenir que dans la <strong>dernière seconde d'un mois</strong> dans la <strong>zone horaire</strong> <code class="cmd">UTC+0</code>, de préférence le <strong>30 juin</strong> ou le <strong>31 décembre</strong> ; </li>

	<li> doit intervenir au <strong>même instant</strong> partout sur le globe – donc à l'heure décalée spécifiquement dans chaque zone horaire. </li>
</ul>

<p> La <strong class="title">décision</strong> de <strong>modifier ou non</strong> l'<strong><em class="sigle">UTC</em></strong> est annoncée environ <strong class="pros">six mois à l'avance</strong> par une publication comme celle‑ci <a class="external" href="https://datacenter.iers.org/data/latestVersion/bulletinA.txt" target="_BLANK"></a>. </p>
</div><!-- complement -->

<div class="exemples">	
<p class="exemple"> Récemment, une <strong class="title">seconde intercalaire</strong> a été ajoutée. </p>
<ul>
	<li> Dans la <strong>zone</strong> <code class="cmd">UTC+0</code>, le <strong>31 décembre 2016</strong>, juste après la seconde <code>T23:59:59</code>, l'heure courante est passée à <code>T23:59:60</code>, avant de basculer (encore une seconde après) au 1<sup>er</sup> janvier 2017, <code>T00:00:00</code>.   </li>

	<li> Dans la zone <code class="cmd">UTC+1</code>, ce changement est intervenu au <strong>même instant</strong> – donc selon l'heure locale, le 1<sup>er</sup> janvier 2017, à <code>T00:59:59</code>. </li>
</ul>
</div><!-- exemple -->


<div style="display: inline-block;">
	<img class="top-right" src="../img/leapSeconds.png" width="400px">
<p> Depuis le 1<sup>er</sup> janvier 1972, en plus des 10 secondes additionnelles de rattrapage initial, un total de <strong class="specialN">27</strong> <strong class="specialY">secondes intercalaires</strong> ont été <strong class="title">ajoutées</strong> à l'<strong><em class="sigle">UTC</em></strong>, portant le décalage avec le <strong><em class="sigle">TAI</em> </strong>à 37 secondes. Le graphique ci‑contre représente la <strong class="specialG">différence</strong> <a class="external" href="https://en.wikipedia.org/wiki/DUT1" target="_BLANK">W</a> : <br>
<span class="inline">
	<strong class="specialG"><em class="sigle">DUT1</em></strong> = <strong><em class="sigle">UT1</em> − <em class="sigle">UTC</em></strong>
</span> <br>
au fil des années depuis 1976. </p>
</div><!-- display -->

<div class="expert">
<p> On constate donc : </p>	
<ul>
	<li> que jusqu'à présent, la <strong>tendance</strong> est constamment à la <strong>baisse</strong> (aucune seconde intercalaire jamais n'a été retranchée), la cause principale étant que la rotation de la Terre ralentit, donc induit un retard croissant de l'<strong><em class="sigle">UT1</em></strong> sur le <strong><em class="sigle">TAI</em></strong> ; </li>

	<li> mais que d'une année à l'autre, le phénomène est <strong class="warning">stochastique</strong>, ce qui est logique en considérant la <strong>multitude des facteurs d'influence</strong> du temps solaire. </li>
</ul>

<p> <strong class="title">En pratique</strong>, l'<strong><em class="sigle">IERS</em></strong> décide de l'ajout ou de la suppression d'une <strong class="specialO">seconde intercalaire</strong> dès que la différence <strong class="specialG"><em class="sigle">DUT1</em></strong></strong> dépasse <em class="bold">±0,5 s</em>. Compte tenu du délai entre l'annonce de la décision et son exécution (6 mois), la différence <strong class="specialG"><em class="sigle">DUT1</em></strong> <strong class="pros">ne dépasse jamais</strong> <em class="bold">±0,8 s</em>. </p>
</div><!-- expert -->

<div class="remarques" id="accelerationRotationTerre">
<p class="remarque"> Au début de l'année 2021, des articles dans la presse <a class="external" href="https://www.20minutes.fr/sciences/2948299-20210109-rotation-terre-accelere-2021-pourrait-donc-etre-raccourcie-seconde" target="_BLANK"></a> ont fait écho du constat que la <strong class="title">rotation de la Terre</strong> s'était très <strong class="warning">légèrement accélérée</strong> ! (On peut déjà observer l'amorce d'un palier tout à droite sur le diagramme ci‑dessus.) Il avait même été évoqué l'éventualité que l'<strong><em class="sigle">IERS</em></strong> prenne prochainement la décision – pour la première fois – de <strong class="warning">soustraire</strong> <strong>une seconde</strong> à l'<strong><em class="sigle">UTC</em></strong> ! </p>

<p> Toutefois, du fait des <strong class="cons">risques informatiques</strong> liés à l'ajustement de <strong><em class="sigle">UTC</em></strong>, il est désormais envisagé de <strong class="defin">ne plus procéder à l'ajout ou retrait des secondes intercalaires</strong> au plus tard en <em class="bold">2035</em>. C'est ce que traduit la résolution nº 4 de la <em>27<sup>e</sup> conférence générale des poids et mesures</em> qui s'est tenue du 15 au 18 novembre 2022 au Palais des Congrès de Versailles <a class="external" href="https://www.bipm.org/documents/20126/64811223/Resolutions-2022.pdf/281f3160-fc56-3e63-dbf7-77b76500990f" target="_BLANK"></a>. </p>
</div><!-- remarques -->


<div class="expert">
<h4> Conséquence sur les unités de temps </h4>


<div class="complement">
<p> En <strong>temps universel coordonné</strong>, la <strong class="title">seconde</strong> et tous ses sous‑multiples ont, comme en temps atomique international, une <strong class="pros">durée fixe</strong>. </p>

<p> En revanche, toutes les <strong class="title">unités supérieures</strong> – <strong class="specialLB">minute</strong>, <strong class="specialLB">heure</strong>, <strong class="specialLB">jour</strong>, <strong class="specialLB">année</strong> – n'ont <strong class="warning">pas toujours la même durée</strong>, selon qu'est intervenu ou non l'ajout ou le retrait d'une <strong class="specialY">seconde intercalaire</strong>. </p>
</div><!-- complement -->

<div style="display: inline-block;">
	<img class="top-right" src="../img/leapSecondEx.png" width="200px" style="padding-top: 0.5em">
<ul>
	<li> Ainsi, une <strong class="specialLB">minute</strong> dure presque toujours <em class="bold">60 s</em> mais peut exceptionnellement durer <em class="bold">61 s</em> en cas de seconde intercalaire additionnelle, étant alors comptée de 0 à 60 – cf. l'image ci‑contre. </li>

	<li> En conséquence, l'<strong class="specialLB">heure</strong> et le <strong class="specialLB">jour</strong> incluant cette minute durent respectivement <em class="bold">3&#8239;601 s</em> et <em class="bold">86&#8239;401 s</em>. </li>
</ul>
</div><!-- display -->

<div class="remarques">
<p class="remarque"> Même exceptionnelles, les <strong class="specialO">secondes intercalaires</strong>  <strong class="cons">compliquent la détermination d'une date d'arrivée</strong> à partir d'une <strong>autre date de départ</strong> et d'une <strong>durée</strong> : il faut tenir compte du nombre de secondes intercalaires ajoutées entre ces deux dates et les décompter de la durée pour pouvoir ensuite opérer une division entière de la durée par celle d'une heure normale (3&#8239;600 s) ou d'une journée normale (86&#8239;400 s). </p>
</div><!-- remarque -->
</div><!-- expert -->





















<h2> Représentation du temps calendaire dans les systèmes informatiques </h2>



<h3 id="iso8601"> Représentations littérales d'une date (haut niveau)</h3>

<p> On rappelle que la <strong class="title">représentation littérale</strong> d'une information est juste une <strong class="defin">écriture formelle</strong> particulière qui peut s'insérer dans tout type de <strong>texte</strong>. </p>

<div class="important">
<p> Pour éviter les ambiguïtés dans les échanges internationaux, la <strong>norme <em class="sigle">ISO 8601</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/ISO_8601" target="_BLANK">W</a> (<em class="english">Data elements and interchange formats</em>) spécifie <strong class="title">diverses représentations littérales</strong> d'une <strong class="title">date</strong> – au sens large, car ce peut aussi être une <strong class="specialLB">heure</strong>, voire une <strong class="specialLB">date et heure</strong> – quelle que soit l'échelle de temps adoptée (<em class="sigle">UTC</em>, <em class="sigle">UT1</em>, <em class="sigle">TAI</em>). </p>

<div style="display: inline-block;">
	<img class="top-right" src="../img/dateLiteral.png" width="400px" style="padding-top: 0.2em">
<p> Ces représentations, <strong class="pros">intelligibles pour l'humain</strong>, sont des <strong class="defin">chaînes de caractères</strong> et se déclinent en <strong class="title">six formats différents</strong>, selon l'<strong>unité de résolution</strong> choisie – typiquement, le <em>jour</em> pour une date calendaire et la <em>seconde</em> pour une heure civile (cf. la figure donnée à titre d'exemple).  </p>
</div><!-- display -->
</div><!-- important -->


<div class="complement">
<p> En règle générale, la <strong class="title">norme <em class="sigle">ISO 8601</em></strong> : </p>
<ul>
	<li> <strong class="warning">exclut</strong> tout emploi de <strong class="cons">noms</strong> (de mois, de jours, etc.) puisqu'ils sont spécifiques à une langue particulière ;  </li>

	<li> impose une représentation <strong class="defin">de gauche à droite</strong> par unités de <strong>durées décroissantes</strong> (année, mois, jour, heure, etc.) ; </li>

	<li> impose l'emploi systématique des <strong class="defin">zéros non significatifs</strong> dans l'expression des numéros de <strong>mois</strong>, <strong>jours</strong>, etc. indépendamment de l'emploi ou non de séparateurs ; </li>

	<li> recourt à des <strong class="specialN">symboles littéraux</strong> spécifiques, par exemple <code class="cmd">T</code> comme préfixe de la représentation d'une heure, pour la séparer de celle d'une date. </li>
</ul>	
</div><!-- complement -->

<div class="expert">
<p class="square"> Ainsi, pour exprimer une <strong class="title">date</strong> du calendrier géorgien, l'unité de résolution étant le <strong class="defin">jour</strong>, le <strong>format normalisé</strong> usuel est <code class="cmd"><span class="nocode"><strong class="specialT">yyyy</strong></span>-<span class="nocode"><strong class="specialT">mm</strong></span>-<span class="nocode"><strong class="specialT">dd</strong></span></code> où : </p>
<ul>
	<li> <code class="cmd"><span class="nocode"><strong class="specialT">yyyy</strong></span></code> représente les 4 digits décimaux du numéro d'<strong>année</strong> (<em>year</em>), </li>

	<li> <code class="cmd"><span class="nocode"><strong class="specialT">mm</strong></span></code> représente les 2 digits décimaux du numéro de <strong>mois</strong> (<em>month</em>), avec la convention usuelle <code>01</code> pour janvier, etc. </li>

	<li> <code class="cmd"><span class="nocode"><strong class="specialT">dd</strong></span></code> représente les 2 digits décimaux du numéro de <strong>jour</strong> (<em>day</em>). </li>
</ul>

<p class="square"> Selon les même principes, pour exprimer une <strong class="title">date et heure <em class="sigle">UTC</em></strong> à la <strong class="defin">seconde</strong> près, le <strong>format normalisé</strong> usuel est : <br>
<span class="inline">
	<code class="cmd"><span class="nocode"><strong class="specialT">yyyy</strong></span>-<span class="nocode"><strong class="specialT">mm</strong></span>-<span class="nocode"><strong class="specialT">dd</strong>&#8239;</span>T<span class="nocode">&#8239;<strong class="specialLG">hh</strong></span>:<span class="nocode"><strong class="specialLG">mm</strong></span>:<span class="nocode"><strong class="specialLG">ss</strong>&#8239;</span><span class="nocode">&#8239;<strong class="specialO">±hh</strong></span>:<span class="nocode"><strong class="specialO">mm</strong></span></code>
</span>	<br>
où l'indication de la <strong class="specialO">zone horaire</strong> (cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#zoneHoraire"></a>) peut être abrégé par la lettre <code class="cmd">Z</code> en cas de <strong>décalage nul</strong> (heure dite <strong><em class="sigle">UTC</em></strong>). </p>

<p> La <strong>norme <em class="sigle">ISO  8601</em></strong> offre par ailleurs de <strong class="pros">très nombreuses possibilités</strong> de représentation, qu'il ne serait pas pertinent de détailler toutes ici. Pour approfondir, on pourra consulter ce lien <a class="external" href="https://en.wikipedia.org/wiki/ISO_8601" target="_BLANK">W</a>.  </p>
</div><!-- expert -->

<div class="exemples">
<p class="exemple"> Dans le <strong>format normalisé</strong> usuel, la <strong class="title">date et heure</strong> d'ouverture de la <em>1<sup>re</sup> session</em> de la <em>26<sup>e</sup> Conférence générale des poids et mesures</em> <a class="external" href="https://www.bipm.org/utils/common/pdf/CGPM/CGPM26.pdf" target="_BLANK"></a>, qui a débuté le <strong>13 novembre 2018</strong> à <strong>9 h</strong> au Palais des congrès de Versailles (zone <strong><em class="sigle">CET</em></strong>), est : <br>
<span class="inline">
	<code class="cmd">2018-11-13T09:00:00+01:00</code>
</span> <br>
Elle correspond à <code>2018-11-13T08:00:00Z</code>, heure <strong><em class="sigle">UTC</em></strong> (sans décalage horaire). </p>
</div><!-- exemple -->



<h3> Représentations numériques d'une date (bas niveau) </h3>



<div class="complement">
<p> Dans une machine informatique, la taille de <strong class="title">représentation en mémoire</strong> d'une <strong class="title">date et heure</strong> de l'échelle <strong><em class="sigle">UTC</em></strong> dépend du <strong class="specialLB">rôle</strong> de cette machine au regard de la mise en œuvre du <strong>protocole <em class="sigle">NTP</em></strong> (cf. l'introduction <a class="supra" href="Rc2-6_serviceTemps.html#intro"></a>). Il faut a priori distinguer le cas : </p>
<ul>
	<li> d'un <strong class="specialLB">serveur de temps</strong> qui a pour rôle de partager la <strong>date et heure courante de référence</strong>, et qui doit par conséquent mémoriser cette valeur avec <strong class="pros">la plus grande résolution</strong> possible – donc dans un <strong class="defin">format de grande taille</strong> ;  </li>

	<li> et tout autre machine qui agit simplement en qualité de <strong class="specialLB">client <em class="sigle">NTP</em></strong> pour bénéficier du partage de la date et heure courante ; sauf cas particulier, elle peut se contenter d'une résolution modérée – donc d'un <strong class="defin">format plus petit</strong>. </li>
</ul>
</div><!-- complement -->

<p> Et même dans le cas des <strong class="title">serveurs de temps</strong>, la résolution requise – donc la <strong class="defin">taille du format</strong> – n'est <strong>pas la même</strong> selon qu'il s'agit : </p>
<ul>
 	<li> d'une machine directement reliée à une <strong>horloge atomique</strong> – on parle de serveur de <strong class="specialLB">statum 1</strong> ;  </li>
 
 	<li> ou d'un serveur dans un réseau local – c'est‑à‑dire de <strong class="specialLB">stratum supérieur à 1</strong>. </li>
 </ul>

<div class="remarques">
<p class="remarque"> Dans ce qui suit, on ne considère <strong class="warning">pas</strong> le cas des montres et autres <strong class="title">équipements radio‑pilotés</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Horloge_radio-pilotée" target="_BLANK">W</a>. En effet, ils utilisent un protocole de communication <strong>différent de <em class="sigle">NTP</em></strong>, qui œuvre exclusivement par ondes électromagnétiques, hors des réseaux <strong><em class="sigle">TCP/IP</em></strong>.  </p>
</div><!-- remarque -->


<h4 id="NTPtimestamp"> Le format <em>timestamp</em> NTP </h4>


<div class="important">
	<img class="top-right" src="../img/NTPtimestamp.png" width="300px">
<p> Pour représenter une <strong>date et heure</strong> sur l'échelle de l'<strong><em class="sigle">UTC</em></strong>, le <strong>protocole <em class="sigle">NTP</em></strong> adopte un <strong class="defin">format décimal</strong> <strong class="specialO">non signé</strong> à <strong class="specialMg">virgule fixe</strong> sur <strong class="specialN">64 bits</strong>, appelé <strong class="title">timestamp <em class="sigle">NTP</em></strong>. </p>

<p> Une <strong class="title">valeur</strong> encodée dans ce format exprime la <strong class="defin">durée en secondes</strong> écoulée depuis depuis le <strong class="specialT">1<sup>er</sup> janvier 1900</strong> à <strong class="specialT">00 h 00</strong> dans la <strong>zone horaire</strong> <code class="cmd">UTC+0</code> – <strong class="specialY">secondes intercalaires</strong> <strong class="warning">non incluses</strong>. </p>

<p> Il s'agit de la <strong class="specialT">date de référence</strong> choisie par convention comme <strong>instant 0 de l'<em class="sigle">UTC</em></strong> et appelée en anglais <strong class="specialT">epoch 0</strong>. </p>
</div><!-- important -->

<div class="complement">
<p> Plus précisément : </p>
<ul>
	<li> La <strong class="specialV">partie entière</strong> est encodée sur <strong class="specialN">32 bits</strong> en <strong class="defin">binaire naturel</strong>, elle peut donc représenter un nombre de secondes compris entre <em class="bold">0</em> et <em class="bold">4&#8239;294&#8239;967&#8239;295</em> (exactement comme le type <code class="prettyprint lang-c">uint32_t</code> en langage <strong>C</strong>).   </li>

	<div class="nobullet"> Autrement dit, elle représente une date incluse dans la <strong class="defin">période actuelle</strong> allant du <strong class="specialT">1<sup>er</sup> janvier 1900</strong> au <strong class="warning">7 février 2036</strong> (partiellement inclus), ce qui laisse augurer des difficultés prochaines (cf. infra <a class="infra" href="Rc2-6_serviceTemps.html#pbTimestamps"></a>). </div>

	<li> La <strong class="specialMg">partie fractionnaire</strong> est encodée <em>presque</em> comme le <strong>significande</strong> du <strong class="specialG">type flottant</strong> en langage <strong>C</strong> (cf. chap. C3‑V <a class="previous" href="../../ModuleC/C3-Numeration/Cc3-5_typesFlottants.html#largeursChamps" target="_BLANK">C</a>) avec des poids fractionnaires en puissances négatives de 2 allant jusqu'à 2<sup>−32</sup> ≃ 2,33 × 10<sup>−10</sup> s – donc avec une résolution de <em class="bold">233 ps</em> (picosecondes). </li>

	<div class="nobullet">Cette résolution est a priori <strong class="pros">largement suffisant</strong> pour de nombreuses <strong>applications courantes</strong>. De plus, il faut tenir compte des écarts impondérables liés à la transmission des dates et heures dans un réseau informatique. Le protocole <strong><em class="sigle">NTP</em></strong> ne pouvant pas garantir une synchronisation meilleure qu'<strong>à la microseconde près</strong>, une résolution d'enregistrement inférieure à la nanoseconde est donc tout à fait satisfaisante. </div>
</ul>
</div><!-- complement -->

<div class="remarques" style="display: inline-block;">
	<img class="top-right" src="../img/datestamp.png" width="200px">
<p class="remarque"> Le terme « <strong class="title">timestamp</strong> » fait référence à un <strong class="defin">outil d'horodatage manuel</strong> de documents comme celui en photo ci‑contre (en anglais, <em class="english">stamp</em> signifie « timbre » ou « tampon »). </p>

<p> En français, on pourrait parler d'<strong>estampille temporelle</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Estampille" target="_BLANK">W</a>, mais dans la pratique, ce terme n'est pas usité. </p>
</div><!-- remarque -->



<h4 id="Posix"> Le format <em>timestamp Unix</em> </h4>


<div class="expert">
<p> Depuis la fin des années 1980, avec le développement de nombreuses variantes du système d'exploitation <strong>Unix</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Unix" target="_BLANK">W</a>, l'<strong><em class="sigle">IEEE</em></strong> (cf. chap. R1‑I <a class="previous" href="../R1-Generalites/Rc1-1_notionsFondamentales.html#organismes" target="_BLANK"></a>) a édité des <strong>normes</strong> pour <strong class="defin">standardiser les interfaces de programmation</strong> des applications (en anglais, <em class="english">application programming interface</em> ou <em class="sigle">API</em>). On les appelle <strong class="title">normes <em class="sigle">POSIX</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/POSIX" target="_BLANK">W</a> pour <strong>portable operating system interface</strong>, le « <strong>X</strong> » faisant référence à celui d'<em class="mark">Unix</em>. </p>

<p> En particulier, les versions récentes d'<strong>Unix</strong> et de ses variantes <strong class="specialLB">Linux</strong> s'efforcent de <strong class="pros">respecter</strong> les <strong class="title">normes <em class="sigle">POSIX</em></strong>. Il en est de même des systèmes d'exploitation pour serveurs comme <strong class="specialLB">Windows NT</strong>. </p>
</div><!-- expert -->

<div class="important">
<p> Les <strong class="defin">normes <em class="sigle">POSIX</em></strong> imposent que la <strong class="specialV">partie entière</strong> de la <strong class="title">date et heure courante</strong> soit encodée dans un <strong class="warning">format différent</strong> de celui du <strong>timestamp <em class="sigle">NTP</em> </strong>. On parle de format <strong class="title">timestamp <em class="sigle">POSIX</em></strong>, appelé également <strong class="title">timestamp Unix</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Heure_Unix" target="_BLANK">W</a>. </p>

<div style="display: inline-block;">
	<img class="top-right" src="../img/Unixtimestamp.png" width="200px" style="padding-top: 0.0em">
<p> Le plus souvent, ce format est implémenté en mémoire par <strong class="specialG">type entier</strong> <strong class="specialO">signé</strong> sur <strong class="specialN">32 bits</strong>, donc d'étendue comprise entre <em class="bold">−2&#8239;147&#8239;483&#8239;648</em> et <em class="bold">2&#8239;147&#8239;483&#8239;647</em>.  </p>

<p> Un <strong class="title">timestamp Unix</strong> exprime en <strong>secondes</strong> – mais sans inclure les <strong class="specialY">secondes intercalaires</strong> – la durée écoulée depuis le <strong class="specialM">jeudi 1<sup>er</sup> janvier 1970</strong> à <strong>00 h 00</strong> exactement dans la zone horaire <code class="cmd">UTC+0</code>. Cette date est appelée en anglais <strong class="specialM">epoch Unix</strong> ou <strong class="specialM"><em class="sigle">POSIX</em></strong>. </p>
</div><!-- display -->
</div><!-- important -->


<div class="complement">
<p> Sachant que 2&#8239;147&#8239;483&#8239;647 secondes représentent une demi‑période de 68 ans environ, un <strong class="title">timestamp Unix</strong> permet d'encoder une date comprise entre le <strong class="specialO">13 décembre 1901</strong> et le <strong class="warning">19 janvier 2038</strong>. </p>

<p> On détermine la valeur d'un <strong class="title">timestamp Unix</strong> correspondant la <strong class="defin">même date et heure</strong> que celle de la <strong class="specialV">partie entière</strong> d'un <strong class="specialN">timestamp <em class="sigle">NTP</em></strong> par la formule : </p>
<div class="inline">
	 <span class="framed" style="background: white;"><strong class="title">timestamp Unix</strong> = <strong class="specialN">timestamp <em class="sigle">NTP</em></strong> − <strong class="specialM">epoch Unix</strong></span>
</div> 
<p> où l'<strong class="specialM">epoch Unix</strong> est exprimée dans le format d'un <strong class="specialN">timestamp <em class="sigle">NTP</em></strong> et vaut <em class="bold">2&#8239;208&#8239;988&#8239;800 s</em> (70 ans). </p>
</div><!-- complement -->

<p> Sur l'Internet, on trouve toutes sortes de <strong class="title">page web</strong> comme celle‑ci <a class="external" href="https://www.timestamp-converter.com/" target="_BLANK"></a> qui : </p>
<ul>
	<li> affiche la <strong class="defin">valeur courante</strong> du <strong>timestamp Unix</strong> ; </li>

	<li> effectue à la demande la <strong class="defin">conversion</strong> au format <strong>date et heure</strong> d'une valeur de <strong>timestamp Unix</strong>, et vice‑versa.</li>
</ul>



<h3 id="pbTimestamps"> Problèmes futurs liés aux représentations numériques des dates </h3>



<div class="complement">
<p> On a vu supra que l'encodage de la date et heure courante sur <strong class="cons">seulement 32 bits</strong>  par un nombre entier de secondes écoulées depuis une date de référence ne permet d'étiqueter le temps calendaire que sur une <strong class="warning">période limitée à 136 ans</strong>. Compte tenu des <strong>dates de références</strong> choisies :  </p>
<ul>
	<li> la <strong class="specialV">partie entière</strong> du <strong class="specialLB">timestamp <em class="sigle">NTP</em></strong> rebouclera à <em class="bold">0</em> en l'an <strong class="warning">2036</strong> ;  </li>

	<li> le <strong class="specialLB">timestamp Unix</strong> rebouclera à <em class="bold">−2&#8239;147&#8239;483&#8239;648</em> en l'an <strong class="warning">2038</strong>.  </li>
</ul>
</div><!-- complement -->


<p> L'un et l'autre de ces <strong class="title">bugs annoncés</strong> sont bien évidemment <strong class="dpros">anticipés</strong> par les concepteurs des systèmes informatiques. </p>

<ul>
	<li> Un <strong>nouveau format</strong> <strong class="defin">date <em class="sigle">NTP</em></strong> avec une <strong class="specialV">partie entière</strong> sur <strong class="defin">64 bits</strong> a justement été introduit dès 2010 dans la <strong>version 4</strong> du protocole <strong><em class="sigle">NTP</em></strong> pour y remédier (cf. infra). Étant <strong class="pros">rétrocompatible</strong> avec le format précédent, il ne pose pas de gros problèmes de mise en œuvre, et c'est pourquoi on peut considérer qu'il n'y aura <strong class="pros">pas de bug de l'an 2036</strong>. </li>

	<li> Dans le même esprit, les <strong>nouvelles versions des systèmes d'exploitation</strong> adoptent <strong class="pros">déjà</strong> un <strong class="defin">format plus large</strong> (64 bits) que l'actuel <strong class="specialLB">timestamp Unix</strong> pour éliminer à très long terme tout risque de débordement. Toutefois, ce nouveau format n'est <strong class="cons">pas rétrocompatible</strong> avec le format précédent à cause du <strong class="specialO">bit de signe</strong>, aussi son adoption est complexe et laisse encore ouverte la question du <strong class="warning">bug de l'an 2038</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Bug_de_l'an_2038" target="_BLANK">W</a>.  </li>
</ul>


<div class="expert">
<h4 id="datestamp"> Le format <em>date NTP</em> </h4>


<div class="complement">
<p> En prévision des <strong>besoins futurs</strong> en précision et étendue, la <strong>version 4</strong> du <strong>protocole <em class="sigle">NTP</em></strong> introduit donc un <strong class="defin">nouveau format d'encodage élargi</strong> – dit <strong class="title">date <em class="sigle">NTP</em></strong> – pour exprimer une date et heure courante de l'échelle de l'<strong><em class="sigle">UTC</em></strong>. Ce format est conçu pour étendre le précédent format <strong>timestamp <em class="sigle">NTP</em></strong> de façon <strong class="pros">rétrocompatible</strong> (cf. la figure ci‑dessous). </p>
	<img class="top-left" src="../img/NTPdatestamp.png" style="min-width: 200px; max-width: 600px">
<p> Toutefois, il n'est <strong class="cons">pas encore utilisé en pratique</strong> pour le <strong>partage de l'<em class="sigle">UTC</em></strong>. </p>
</div><!-- complement -->

<div class="important">
<p> Il en résulte que le format <strong class="title">date <em class="sigle">NTP</em></strong> est également <strong class="defin">décimal</strong> à <strong class="specialMg">virgule fixe</strong>, mais implémenté avec : </p>
<ul>
	<li> une <strong class="specialV">partie entière</strong> encodée sur <strong>64 bits</strong>, avec un <strong class="specialO">bit de signe</strong> opérant en <strong>complément à 2</strong> (cf. chap. C3‑II <a class="previous" href="../../ModuleC/C3-Numeration/Cc3-2_typesEntiers.html#complementA2" target="_BLANK">C</a>) ; </li>

	<li> une <strong class="specialMg">partie décimale</strong> également encodée sur <strong>64 bits</strong> ; </li>
</ul>
<p> soit une largeur totale de <strong class="specialN">128 bits</strong> (16 octets). </p>
</div><!-- important -->

<p> Le <strong class="specialO">signe</strong> de la partie entière s'interprète comme suit :  </p>
<ul>
	<li> toute <strong>valeur positive</strong> correspond à une date et heure <strong>ultérieure</strong> à la <strong class="specialT">date de référence</strong> ;  </li>

	<li> toute <strong>valeur négative</strong> correspond à une date et heure <strong>antérieure</strong> à la <strong class="specialT">date de référence</strong> ;   </li>
</ul>
<p> sachant que la <strong class="specialT">date de référence</strong> reste la même que celle du <strong>timestamp <em class="sigle">NTP</em></strong>, à savoir le <strong class="specialT">1<sup>er</sup> janvier 1900</strong> à <strong class="specialT">00 h 00</strong> dans la <strong>zone horaire</strong> <code class="cmd">UTC+0</code>. </p>

<p> Avec une largeur de <strong>64 bits</strong>, le format de la <strong class="specialMg">partie entière</strong> est semblable au type <code class="prettyprint lang-c">long long</code> du langage <strong>C</strong> (cf. chap. C3‑II <a class="previous" href="../../ModuleC/C3-Numeration/Cc3-2_typesEntiers.html#entiersStandards" target="_BLANK"></a>), qui peut encoder plus de 18 milliards de milliards de valeurs. Cela est <strong class="pros">largement suffisant</strong> pour exprimer plus de 40 fois l'âge actuel de l'Univers <a class="external" href="https://fr.wikipedia.org/wiki/Âge_de_l'Univers" target="_BLANK">W</a> ! </p>

<p> Quant à la <strong class="specialMg">partie fractionnaire</strong>, elle atteint une <strong>résolution</strong> allant jusqu'à 2<sup>−64</sup> ≃ <em class="bold">5 × 10<sup>−20</sup> s</em> – laquelle est <strong class="pros">un million de fois plus petite</strong> que la résolution du <strong>temps atomique</strong> (cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#secondeAtomique"></a>) ! </p>	

<p> Soulignons toutefois que même dans sa version <strong>v4</strong>, le format des messages du <strong>protocole <em class="sigle">NTP</em></strong> <strong class="warning">ne permet pas</strong> de transmettre des données au format <strong class="title">date <em class="sigle">NTP</em></strong>. Ce dernier ne peut servir que pour mémoriser la date et heure courante dans les <strong class="defin">horloges atomiques</strong>. </p>


<!-- expert -->
<h4> La notion d'ère </h4> 


<div class="complement">
<p>	Pour exprimer des <strong class="specialLB">dates antérieures</strong> ou <strong class="specialLB">ultérieures</strong> à la <strong class="specialT">période actuelle</strong> couverte par le <strong>timestamp <em class="sigle">NTP</em></strong> (du 1<sup>er</sup> janvier 1900 au 7 février 2036) mais <strong class="pros">sans recourir</strong> au format <strong>date <em class="sigle">NTP</em> complet</strong>, le <strong>protocole <em class="sigle">NTP</em></strong> introduit la notion d'<strong class="title">ère</strong> – en anglais, <strong>era</strong>. </p>

<p> Elle consiste à former un ordinal de type <strong class="specialO">entier signé</strong> avec les <strong class="defin">bits <em class="bold">0</em> à <em class="bold">31</em></strong> du format <strong>date <em class="sigle">NTP</em></strong>. </p>

<img class="top-left" src="../img/NTPera.png" style="min-width: 200px; max-width: 600px">

<p> Ce <strong class="title">numéro d'ère</strong> peut prendre des valeurs allant de <em class="bold">−2&#8239;147&#8239;483&#8239;648</em> à <em class="bold">2&#8239;147&#8239;483&#8239;647</em>, chacune désignant une période d'environ 136 ans – soit environ 18 × 10<sup>18</sup> années au total ! Il suffit alors d'associer un <strong>numéro d'ère</strong> à un <strong>timestamp <em class="sigle">NTP</em></strong> pour reconstituer la partie entière d'une valeur encodée au format <strong class="defin">date <em class="sigle">NTP</em></strong>. </p>
</div><!-- complement --> 

<p> Ainsi : </p>
<ul>
	<li> l'<strong class="specialLB">ère</strong> <em class="bold">0</em> correspond à la <strong class="specialT">période actuelle</strong> ;  </li>

	<li> l'<strong class="specialLB">ère</strong> <em class="bold">−1</em> correspond à la <strong>période</strong> allant de l'année 1764 à l'année 1899 ;</li>

	<li> l'<strong class="specialLB">ère</strong> <em class="bold">+1</em> correspond à la <strong>période</strong> allant de l'année 2036 à l'année 2172 ; </li>

	<li> etc.</li>
</ul>
<p> sachant que les changements d'ère se produisent en cours d'année (et même de journée…). </p>

<p> Toutefois, même dans sa version <strong>v4</strong>, le format des messages du <strong>protocole <em class="sigle">NTP</em></strong> <strong class="warning">ne permet pas</strong> de transmettre des données d'<strong class="title">ère</strong>. </p>
</div><!-- expert -->



<h3> Prise en compte des secondes intercalaires </h3>



<div class="complement">
<p> Il peut paraître surprenant que le format <strong>date <em class="sigle">NTP</em></strong> – et donc les <strong>timestamp <em class="sigle">NTP</em></strong> et <strong>Unix</strong> (ou <strong>Posix</strong>) qui en sont issus donnent la <strong class="defin">date et heure <em class="sigle">UTC</em></strong> alors que, par un choix de conception, <strong class="warning">n'incluent pas</strong> les <strong class="specialY">secondes intercalaires</strong> (cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#datestamp"></a>). </p>

<p> Ce choix se justifie au regard d'un <strong class="title">objectif opérationnel principal</strong> : pouvoir <strong class="defin">déterminer un temps calendaire</strong> par un <strong class="pros">algorithme immuable</strong> relativement <strong class="pros">simple</strong>, c'est‑à‑dire être capable de calculer la <strong>date et heure <em class="sigle">UTC</em></strong> à partir d'un <strong>timestamp <em class="sigle">NTP</em></strong>, et réciproquement (sauf aux instants d'ajustement par une seconde intercalaire, qui sont exceptionnels). </p>

<p> En contre‑partie, ce choix <strong class="cons">obère la possibilité de calculer une durée</strong> par simple soustraction entre deux <strong>timestamp <em class="sigle">NTP</em></strong> étiquetant deux instants sur l'échelle de l'<strong><em class="sigle">UTC</em></strong>. En effet, pour effectuer un tel calcul, il faut, en plus de la soustraction, <strong class="warning">tenir compte</strong> des <strong class="specialY">secondes intercalaires</strong> éventuellement ajoutées ou retranchées entre ces deux instants. </p>
</div><!-- complement -->

<div class="expert">
<p> Pour bien comprendre ces deux aspects, il faut étudier en détail la <strong class="title">gestion des secondes intercalaires</strong> avec les échelle de temps <strong class="specialN"><em class="sigle">TAI</em></strong> et <strong class="specialG"><em class="sigle">UTC</em></strong>. </p>	


<!-- expert -->
<h4> Cas d'une seconde ajoutée </h4>


<p> Prenons l'<strong class="title">exemple</strong> de la <strong class="specialY">seconde intercalaire</strong> qui a été ajoutée le <strong class="defin">30 juin 2015</strong>, détaillée sur la figure ci‑dessous. </p>

	<img class="top-left" src="../img/leapSecondEx2.png" style="max-width: 800px">

<ul>
	<li> Sur l'échelle du <strong class="specialN"><em class="sigle">TAI</em></strong> (temps atomique international), le compteur des secondes écoulées depuis le 1<sup>er</sup> janvier 1900 est <strong>incrémenté régulièrement</strong>. </li>

	<li> En revanche, sur l'échelle de l'<strong class="specialG"><em class="sigle">UTC</em></strong>, le compteur des secondes que constitue la partie entière du <strong>timestamp <em class="sigle">NTP</em></strong> est comme <strong class="defin">figée durant une seconde</strong> à la valeur <code>3644697600</code>. </li>

	<div class="nobullet"> Durant cette <strong class="specialY">seconde intercalaire</strong> insérée, bien visible graphiquement, l'<strong class="specialLN">horloge officielle</strong> affiche l'<strong class="warning">heure exceptionnelle</strong> <span class="framedSmall"><code>23:59:<span class="red">60</span></code></span>. </div>

	<li> Au passage, la différence <span class="framedFull"><strong class="specialN"><em class="sigle">TAI</em></strong> − <strong class="specialG"><em class="sigle">UTC</em></strong></span> augmente d'une unité : elle passe de <code>35</code> à <code>36</code>. </li>
</ul>

<p> En définitive, on constate que <strong class="defin">deux secondes différentes</strong> du <strong class="specialN"><em class="sigle">TAI</em></strong> correspondent à une <strong class="warning">même valeur</strong> du <strong>timestamp <em class="sigle">NTP</em></strong>. Pour conserver une relation d'ordre total sur ces valeurs, on doit donc distinguer <strong class="defin">deux échelles</strong>, <strong>avant</strong> et <strong>après</strong> l'ajout de la <strong class="specialY">seconde intercalaire</strong>. </p>

<p> On peut également observer qu'à l'heure remarquable <code>00:00:00</code>, la valeur <code>3644697636</code> du <strong>timestamp <em class="sigle">TAI</em></strong> n'est <strong class="cons">pas un multiple</strong> de 86&#8239;400 (la durée d'un jour en secondes). Il n'y a donc <strong class="cons">pas d'algorithme simple</strong> pour établir la correspondance entre le <strong class="specialN"><em class="sigle">TAI</em></strong> et le <strong class="defin">temps calendaire</strong>. </p> 

<p class="square"> Pour une compréhension plus fine de l'ajout d'une <strong class="specialY">seconde intercalaire</strong>, il est  pertinent de le schématiser sur un <strong class="title">diagramme bidimensionnel</strong>, avec en abscisse le <strong class="specialN"><em class="sigle">TAI</em></strong> et en ordonnée l'<strong class="specialG"><em class="sigle">UTC</em></strong>, comme ci‑dessous. </p>
<div style="display: inline-block;">
	<img class="top-right" src="../img/leapSecondPrinciple.png" width="400px">
<ul>
	<li> En règle générale, la relation entre les deux échelles est une <strong class="specialLB">droite à 45°</strong>, puisque chaque incrémentation sur l'une opère également sur l'autre de façon synchrone. </li>

	<li> Mais lors de l'ajout d'une <strong class="specialY">seconde intercalaire</strong>, un décalage vers la droite apparaît. Durant cette seconde, le <strong>timestamp <em class="sigle">NTP</em></strong> est <strong class="specialY">figé</strong>. </li>

	<div class="nobullet"> En revanche, on opère une <strong class="warning">technique différente</strong> pour le <strong>timestamp Unix</strong> : ce dernier est <strong class="specialY">décrémenté</strong> juste avant le début de la seconde intercalaire, puis incrémenté normalement, comme toutes les secondes. </div>
</ul>
</div><!-- display -->


<!-- expert -->
<h4> Cas d'une seconde retranchée </h4>


<p> La <strong class="title">suppression d'une seconde intercalaire</strong> n'ayant jamais été effectuée depuis l'adoption du temps universel coordonné, il n'y a donc <strong class="cons">pas d'exemple réel</strong> sur lequel se baser comme on vient de le faire pour une seconde additionnelle. On peut toutefois raisonner avec des <strong class="defin">valeurs génériques</strong> de <strong>timestamp</strong> sur les échelles du <strong class="specialN"><em class="sigle">TAI</em></strong> et de l'<strong class="specialG"><em class="sigle">UTC</em></strong> au moment de la suppression, qu'on note respectivement  <strong class="specialN">n</strong> et <strong class="specialG">m</strong>, comme sur la figure ci‑dessous. </p>

<img class="top-left" src="../img/leapSecondMinus.png" style="max-width: 800px">

<ul>
	<li> Sur l'échelle du <strong class="specialN"><em class="sigle">TAI</em></strong>, le <strong>timestamp</strong> est <strong class="pros">incrémenté normalement</strong> lors de la suppression de la seconde intercalaire, sans aucune irrégularité. </li>

	<li> En revanche, sur l'échelle de l'<strong class="specialG"><em class="sigle">UTC</em></strong>, le <strong>timestamp <em class="sigle">NTP</em></strong> est <strong class="specialY">incrémenté de deux unités</strong> à la fin de la seconde <span class="framedSmall"><em class="bold" style="color: green"><var>m</var> − 2</em></span> et passe donc directement à la valeur <span class="framedSmall"><em class="bold" style="color: green"><var>m</var></em></span> sans passer par <em class="bold" style="color: green"><var>m</var> − 1</em>. </li>

	<div class="nobullet"> Ici, la <strong class="specialY">seconde intercalaire</strong><strong class="cons"> ne peut pas être représentée graphiquement</strong> puisqu'elle est soustraite (en quelque sorte, elle n'existe pas). </div>
</ul>

<p> Pour ne pas avoir une <strong class="warning">irrégularité d'échelle</strong> résultant de cette double incrémentation, il est nécessaire là aussi de distinguer <strong class="defin">deux échelles</strong>, <strong>avant</strong> et <strong>après</strong> la suppression de la <strong class="specialY">seconde intercalaire</strong>. </p>
</div><!-- expert -->



<h3> Prise en compte des zones horaires et de l'heure d'été </h3>


<div class="important">
<p> La prise en compte des <strong class="title">zones horaires</strong> et de l'<strong class="title">heure d'été</strong> est <strong class="defin">indépendante de l'<em class="sigle">UTC</em></strong>, dont l'échelle n'est pas affectée en lui‑même par ces changements. Il s'agit simplement de <strong>décalages</strong> pour définir la <strong>date et heure locale</strong> dans un lieu donné. </p>
</div><!-- important -->

<div class="complement">
<p> Dans le cas d'un <strong class="title">système informatique</strong>, il peut être préférable <strong class="defin">régler l'horloge interne sur l'<em class="sigle">UTC</em></strong> et d'appliquer le décalage de la zone horaire uniquement pour les affichages. </p>

<p> Mais si, au contraire, l'horloge interne de la machine est <strong class="defin">directement réglée</strong> sur l'<strong class="title">heure locale</strong>, alors il est impératif de <strong class="warning">conserver en mémoire</strong> la <strong>zone horaire</strong> et l'éventuel décalage du <strong><em class="sigle">DST</em></strong>, sinon aucun horodatage ne peut ensuite être situé sur l'échelle de l'<strong><em class="sigle">UTC</em></strong>.  </p>
</div><!-- complement -->




















<h2> Partage du temps universel coordonné </h2>



<h3> Généralités </h3>



<div class="important">
<div style="display: inline-block;">
	<img class="top-right" src="../img/coucheApplication.png" width="150px" style="margin-top:1em">		
<p> Le <strong class="title">partage de l'<em class="sigle">UTC</em></strong> sur un réseau – en particulier via l'Internet – peut s'effectuer par l'intermédiaire de divers <strong class="defin">protocoles applicatifs</strong> (c'est‑à‑dire appartenant à la couche n° 7 du modèle <em class="sigle">OSI</em>). Le choix du protocole dépend des besoins en <strong>précision</strong>, mais aussi des contraintes de <strong>sécurité</strong>. </p>
</div><!-- display -->

<p> Développé au milieu des années 1980, le <strong class="title">protocole <em class="sigle">NTP</em></strong> <a class="external" href="https://fr.wikipedia.org/wiki/Network_Time_Protocol" target="_BLANK">W</a> (<strong>network time protocol</strong>) est de loin <strong class="defin">le plus utilisé</strong> pour le partage du temps. Sa dernière version – <strong>v4</strong>, basée sur la <strong><em class="sigle">RFC 5905</em></strong> <a class="external" href="https://datatracker.ietf.org/doc/html/rfc5905" target="_BLANK"></a> publiée en 2010 – tend à se généraliser progressivement dans les systèmes d'exploitation des machines. </p>
</div><!-- important -->

<div class="expert" style="display: inline-block;">
	<img class="top-right" src="../img/DL_Mills2.png" width="120px" style="padding-top: 0.2em">
<p> Initié par les travaux du Pr. David Mills <a class="external" href="https://en.wikipedia.org/wiki/David_L._Mills" target="_BLANK">W</a> qui a accompli l'essentiel de sa carrière à l'Université du Delaware (<em class="sigle">USA</em>), le <strong class="title">protocole <em class="sigle">NTP</em></strong> est étonnamment <strong class="warning">complexe</strong> au regard de l'<strong>apparente simplicité</strong> de son objectif principal : <strong class="defin">partager le timestamp</strong> de la <strong class="defin">date et heure courante</strong> sur l'échelle de l'<strong><em class="sigle">UTC</em></strong>. </p>

<p> Cette <strong class="title">complexité</strong> s'explique par le fait : </p>

<ul>
	<li> que la donnée partagée est <strong class="cons">constamment changeante</strong> ; </li>

	<li> que pour garantir une <strong class="defin">précision meilleure que la seconde</strong>, il faut tenir compte des <strong class="cons">délais de transmission</strong> sur le réseau, qui sont très contextuels selon le client, le serveur et la distance qui les sépare ; ces délais constituent un <strong class="warning">facteur d'erreur</strong> significatif ;  </li>

	<li> qu'il existe par ailleurs de très <strong class="cons">nombreuses causes de déréglage</strong> des horloges (dérive, défaillance d'un composant, défaut d'alimentation…) ; en conséquence, la consultation d'<strong>une seule horloge</strong> ne garantit <strong class="warning">pas toujours</strong> une <strong>précision satisfaisante</strong> de la date et heure courante transmise. </li>
</ul>
</div><!-- expert -->


<div class="complement">
<p> Pour atteindre l'objectif de synchroniser les machines en réseau avec une précision de l'ordre de la milliseconde, le <strong>protocole <em class="sigle">NTP</em></strong> prévoit <strong class="title">plusieurs modes d'association</strong> possibles <a class="external" href="https://techhub.hpe.com/eginfolib/networking/docs/switches/5950/5200-4022_nmm_cg/content/499754306.htm" target="_BLANK"></a> entre machines pour le partage la <strong>date et heure courante de l'<em class="sigle">UTC</em></strong>. </p>
<ul>
	<li> Le mode <strong class="specialLB">client‑serveur</strong> permet à toute <strong>machine</strong> en réseau (poste de travail, serveur, carte à microcontrôleurs, routeur, etc.) de se <strong class="defin">synchroniser individuellement</strong> à la <strong>date et heure courante de l'<em class="sigle">UTC</em></strong>.  </li>

	<li> Le mode <strong class="specialLB">pair‑à‑pair</strong> permet à un <strong>pool de serveurs de temps</strong>  de se <strong class="defin">synchroniser mutuellement</strong> pour garantir une <strong class="pros">meilleure précision</strong> de la <strong>date et heure courante</strong> qu'ils sont en mesure de partager  </li>

	<div class="expert">
	<div class="nobullet"> Dans ce mode, la machine qui initie la synchronisation est appelée le <strong class="specialN">pair actif</strong> – elle agit à la manière d'un <em>client</em> – et la machine sollicitée est appelée par opposition le <strong class="specialN">pair passif</strong> – qui agit à la manière d'un <em>serveur</em>.  </div>
	</div><!-- expert -->	

	<li> un mode de <strong class="specialLB">diffusion</strong>   qui permet à un serveur de temps de <strong class="defin">cadencer la synchronisation</strong> d'un <strong>ensemble de machines</strong> dans son réseau local – diffusion <strong>broadcast</strong> – ou dans une liste d'abonnement – diffusion <strong>multicast</strong>. </li>
</ul>

<p> Comme la plupart des protocoles applicatifs de service, <strong class="title"><em class="sigle">NTP</em></strong> n'est donc pas simplement basé sur des <strong>algorithmes d'émission‑réception</strong> de messages, il repose aussi sur une <strong class="defin">architecture matérielle spécifique</strong> dont la <strong class="pros">grande redondance</strong> permet de garantir une référence temporelle fiable. </p>
</div><!-- complement -->



<h3> Architecture des serveurs NTP </h3>



<div class="important" style="display: inline-block;">
<p> La mise en œuvre du  <strong>protocole <em class="sigle">NTP</em></strong> s'appuie des <strong class="title">arborescences descendantes de machines</strong> hiérarchisées en <strong class="specialLB">strates</strong> <a class="external" href="https://en.wikipedia.org/wiki/Network_Time_Protocol#Clock_strata" target="_BLANK">W</a>. Dans une telle arborescence : </p>
<ul>
	<li> la strate des <strong>racines</strong> – dite <strong class="specialLB">stratum 0</strong> – est implémentée par des <strong class="defin">horloges atomiques</strong> ; ces dernières ne communiquent qu'avec la strate immédiatement inférieure, typiquement par liaison série ; </li>

	<li> la strate immédiatement inférieure – dite <strong class="specialLB">stratum 1</strong> – constitue les <strong class="defin">serveurs primaires</strong> de temps ; </li>

	<li> la strate suivante – dite <strong>stratum 2</strong> – constitue les <strong class="defin">serveurs secondaires</strong> de temps qui sont beaucoup plus nombreux (mais un peu moins précis) que les serveurs primaires ; etc.</li>
</ul>
<p> Plus le <strong class="specialLB">numéro de stratum</strong> est <strong>petit</strong>, meilleure est la <strong class="pros">précision</strong> de la <strong>date et heure courante</strong> partagée. </p>
</div><!-- important -->

<img class="top-left" src="../img/poolServeursNTP.jpg" w style="max-width: 800px";>

<div class="complement">
<p> <strong class="title">Dans une strate</strong> (à l'exception du <em>stratum 0</em>) : </p>
<ul>
	<li> les machines obtiennent la <strong>date et heure courante</strong> en mode <strong class="specialLB">client‑serveur</strong> depuis la <strong>strate immédiatement supérieure</strong> ; ainsi, un <strong>serveur de temps</strong> agit régulièrement comme <strong class="defin">client <em class="sigle">NTP</em></strong> pour se synchroniser ; on parle de <strong class="defin">synchronisation verticale</strong> ;  </li>

	<li> certains serveurs de temps peuvent agir en mode <strong class="specialLB">pair‑à‑pair</strong> pour affiner leur synchronisation ; on parle de <strong class="defin">synchronisation horizontale</strong>.  </li>
</ul>
</div><!-- complement -->


<h4> Différents cas de figure selon le réseau local </h4>


<div class="complement" style="display: inline-block;">
<p> Dans un <strong class="title">réseau local</strong>, <em class="remark">sauf</em> si l'on souhaite constituer un pool de serveurs de temps, il n'est <strong class="pros">pas nécessaire</strong> de mettre en place une <strong>arborescence <em class="sigle">NTP</em></strong>. </p>
</div><!-- complement -->

<ul>
	<li> Dans les <strong class="specialLB">cas les plus simples</strong> (collectivités, administrations, petites entreprises sans besoins spécifiques), il suffit simplement de <strong class="defin">paramétrer les systèmes d'exploitation</strong> des machines pour qu'ils se synchronisent régulièrement sur des <strong>serveurs de temps publics</strong> sur l'Internet. </li>


  <div class="nobullet"> Avec le <strong>protocole <em class="sigle">NTP</em></strong>, la <strong class="defin">précision usuelle</strong> obtenue est de l'ordre de la <strong>seconde</strong>, mais il n'est pas exclu qu'une machine soit <strong class="cons">parfois désynchronisée</strong>, en particulier si elle est restée longtemps hors‑service.  </div>
  
	<li> Dans des contextes qui requièrent une <strong class="specialLB">précision meilleure que la seconde</strong> et/ou avec une <strong class="specialLB">grande fiabilité</strong>, un ou plusieurs <strong class="defin">serveurs de temps dédiés</strong>, avec plusieurs <strong class="pros">sources de synchronisation redondantes</strong> (Internet, satellite, radio) sont nécessaires.  </li>

	<div class="nobullet"> La figure ci‑dessous illustre une <strong>architecture possible</strong> pour de tels contextes comme par exemple la production manufacturière soumise à une réglementation stricte (industrie pharmaceutique, etc.), la vidéo surveillance de lieux sensibles (centres de détention, banques, etc.), les requêtes sur des bases de données partagées très précises (opérations sur les marchés financiers…), etc. </div>
	<img class="top-left" src="../img/serveurNTP.png"  style="max-width: 800px">
	<!-- refaire cette figure -->
</ul>


<h4> Machine dédiée serveur de temps </h4>


<div class="complement" style="display: inline-block;">
  <img class="top-right" src="../img/serveurTemps.png" width="500px">

<p> Une <strong>machine dédiée</strong> en <strong class="title">serveur de temps</strong> <a class="external" href="https://en.wikipedia.org/wiki/Time_server" target="_BLANK">W</a> est une <strong class="defin">machine serveur</strong> (en général, de type rack) qui dispose : </p>
<ul>
	<li> d'un <strong>circuit d'horloge interne</strong> <strong class="pros">très précis</strong> ;  </li>

	<li> d'un ou plusieurs <strong class="pros">plusieurs</strong> <strong>moyens de synchronisation</strong> (liaison directe à une horloge atomique, antenne satellite, antenne radio) sur des références de temps classifiées <strong class="defin">stratum 0</strong> ;  </li>

	<li> d'une ou plusieurs <strong>interfaces réseau</strong> <strong class="pros">très rapides</strong> pour pouvoir partager sa date et heure courante avec de bonnes performances. </li>
</ul>
<p> Très souvent, elle est aussi dotée d'une <strong>interface utilisateur</strong> avec un <strong class="defin">afficheur</strong> pour visualiser la date et l'heure courante. </p>
</div><!-- complement -->

<p> De plus, elle doit exécuter en <strong>tâche de fond</strong> un <strong class="title">composant logiciel</strong> qui met en œuvre un <strong>protocole de partage de temps</strong> en qualité de serveur, typiquement <strong class="defin"><em class="sigle">NTP</em></strong>. </p>


<div class="expert">
<h4 id="poolNTP"> Les serveurs de temps publics </h4>	


<div class="complement">
<p> Un grand nombre de <strong class="title">serveurs de temps</strong> sont <strong class="pros">librement accessibles</strong> sur l'Internet. On en trouve une <strong>liste</strong> des <strong>noms de domaines</strong> assez fournie au lien suivant <a class="external" href="https://gist.github.com/mutin-sa/eea1c396b1e610a2da1e5550d94b0453" target="_BLANK">G</a>. </p>
</div><!-- complement -->

<p> Parmi ces <strong class="title">noms de domaines</strong>, on peut notamment citer : </p>
<ul>
	<li> ceux des <strong class="specialLB">grandes entreprises</strong> de l'Internet (<em class="mark">Google</em>, <em class="mark">Facebook</em>, <em class="mark">Cloudflare</em>, <em class="mark">Facebook</em>, <em class="mark">Apple</em>, <em class="mark">Microsoft</em>, etc.) ;  </li>

	<li> ceux du <strong class="specialLB">gouvernement des États‑Unis</strong> – le <em class="mark">National Internet time service</em>, abrégé <strong><em class="sigle">NIST</em></strong> – dont le nom de domaine principal <code class="filename">time.nist.gov</code> donne accès exclusivement à des serveurs de <strong class="pros">stratum 1</strong> ; </li>

	<li> ceux du <strong class="specialLB">NTP pool project</strong> donc le nom de domaines principal est <code class="filename">pool.ntp.org</code> <a class="external" href="https://www.ntppool.org/fr/#news" target="_BLANK"></a>. </li>

	<div class="nobullet"> Il s'agit d'un ensemble de <strong class="defin">clusters de serveurs de temps publics</strong> <strong class="specialN">régionalisés</strong> qui peuvent répondre à un très grand nombre de requêtes. Ils sont très souvent utilisés dans les distributions <strong class="specialLB">Linux</strong> pour la synchronisation par défaut au temps Internet. </div>

	<div class="nobullet"> Dans le <strong>NTP pool project</strong>, le <strong>nom de domaine</strong> d'un serveur de temps peut être composé pour <strong class="defin">spécifier un continent</strong> ou même un <strong class="defin">pays</strong> de localisation, et ainsi <strong class="pros">réduire les délais de transmission</strong>, donc les sources d'imprécision. <em class="remark">Par exemple</em>, pour synchroniser une machine en <strong>France métropolitaine</strong>, il est optimal d'utiliser le nom de domaine : <br>
	<span class="inline">
		<code class="filename">fr.pool.ntp.org</code>
	</span> </div>
</ul>

</div><!-- expert -->



<h3 id="messageNTP"> Aspects logiciels généraux du protocole NTP </h3>


<div class="important">
<p> Pour des raisons évidente de <strong class="pros">rapidité</strong> et de <strong class="pros">légèreté</strong>, le protocole <strong class="title"><em class="sigle">NTP</em></strong> utilise le <strong>protocole de transport</strong> <strong class="specialO"><em class="sigle">UDP</em></strong> (cf. chap. R1‑IV <a class="previous" href="../R1-Generalites/Rc1-4_protocoles.html#UDP.html" target="_BLANK"></a>) pour la transmission de ses messages. </p>

<p> Il exploite le <strong class="title">port nº 123</strong>, tant pour l'<strong>émission</strong> que pour la <strong>réception</strong> des messages. </p>
</div><!-- important -->

<div class="complement"  style="display: inline-block;">
  <img class="top-right" src="../img/NTPmessage.png" width="500px">
<p> Le <strong>protocole <em class="sigle">NTP</em></strong> adopte un <strong class="title">format de message unique</strong>, quel quel soit le mode d'association et quel que soit le rôle de la machine dans ce mode. Ce format est détaillé en figure ci‑contre de façon classique par un <strong>tableau</strong> d'une suite de <strong>mots de 4 octets</strong> (32 bits). </p>

<p> Un <strong>message <em class="sigle">NTP</em></strong> se divise en <strong class="title">deux parties</strong> : </p>
<ul>
	<li> un <strong class="specialG">en‑tête</strong> de <strong>48 octets</strong>, comprenant diverses informations administratives, suivies par <strong>4 champs</strong> de 8 octets chacun (64 bits) pour y inscrire respectivement <strong class="defin">4 timestamp</strong> (<code>ref</code>, <code>org</code>, <code>rec</code>, <code>xmt</code>) ;  </li>

	<li> une <strong class="specialLG">partie optionnelle</strong> constituée potentiellement de deux <strong>champs d'extension</strong>, chacun de taille variable, et toujours suivis : </li>
	<ul>
	 	<li> d'une <strong>clef d'identification</strong> de 32 bits ;  </li>
	 
	 	<li> d'un <strong>message d'authentification</strong> de 128 bits dit <strong><em class="sigle">MAC</em></strong> (pour<em class="english"> message authentication code</em>). </li>
	 </ul>
</ul>
</div><!-- complement -->


<div class="expert">
<h4> Codage des champs d'un message NTP </h4>	


<p> Détaillons maintenant le <strong class="title">codage de chaque champ</strong> de l'<strong class="specialG">en‑tête</strong> d'un <strong>message <em class="sigle">NTP</em></strong> en <strong>version 4</strong>. </p>

<ul>
	<li> <code class="cmd">LI</code>, pour <strong class="specialLB">leap indicator</strong>, codé sur 2 bits, avertit si une <strong class="specialY">seconde intercalaire</strong> va intervenir <strong>à la fin du mois</strong> en cours, avec le détail des valeurs ci‑dessous :  </li>
	<div style="overflow-x: auto; margin: 0.5em;">
  <table style="margin: 0em; ">
  	<tr>
  		<th> <code>0</code> </th> 
  		<td> <strong>pas</strong> de seconde intercalaire </td>
  	</tr>	
  	<tr>
  		<th> <code>1</code> </th> 
  		<td> seconde intercalaire <strong>ajoutée</strong> </td>
  	</tr>	
  	<tr>
  		<th> <code>2</code> </th> 
  		<td> seconde intercalaire <strong>retranchée</strong> </td>
  	</tr>	
  	<tr>
  		<th> <code>3</code> </th> 
  		<td> statut <strong>inconnu</strong> (horloge désynchronisée) </td>
  	</tr>	
  </table>
  </div><!-- overflow -->	

	<li> <code class="cmd">VN</code>, pour <strong class="specialLB">version number</strong>, codé sur 3 bits, précise le <strong class="defin">numéro de la version du protocole</strong> employée ;  </li>

	<li> <code class="cmd">mode</code>, codé sur 3 bits, indique le <strong class="defin">mode d'association</strong> adopté par l'<strong>émetteur</strong> du message, avec le détail des principales valeurs ci‑dessous :  </li>
	<div style="overflow-x: auto; margin: 0.5em;">
	<table style="margin: 0em; ">
  	<tr>
  		<th> <code>0</code> </th> 
  		<td> valeur réservée pour un usage ultérieur </td>
  	</tr>	
  	<tr>
  		<th> <code>1</code> </th> 
  		<td> <strong>pair</strong> symétrique actif </td>
  	</tr>	
  	<tr>
  		<th> <code>2</code> </th> 
  		<td> <strong>pair</strong> symétrique passif </td>
  	</tr>	
  	<tr>
  		<th> <code>3</code> </th> 
  		<td> <strong>client</strong> </td>
  	</tr>	
  	<tr>
  		<th> <code>4</code> </th> 
  		<td> <strong>serveur</strong> </td>
  	</tr>	
  	<tr>
  		<th> <code>5</code> </th> 
  		<td> <strong>broadcast</strong> </td>
  	</tr>	
  </table>
  </div><!-- overflow -->

  <li> <code class="cmd">stratum</code>, codé sur 8 bits, indique la <strong class="defin">strate</strong> du <strong>serveur émetteur</strong> du message, sachant que : </li>	
  <ul>
		<li> <code class="cmd">0</code> signifie <strong class="warning">invalide</strong>, lorsque le serveur ne délivre pas le <em class="english">timestamp</em> attendu (pour diverses raisons, cf. infra) ; </li>

		<div class="nobullet"> mais <code class="cmd">0</code> signifie aussi <strong class="specialV">non spécifié</strong> et c'est la valeur codée par un <strong>simple client</strong> (n'étant pas un serveur, il n'a pas de <strong>stratum</strong>) ; </div>
  	
  	<li> <code class="cmd">16</code> signifie que la machine est <strong class="cons">désynchronisée</strong>. </li>
  </ul>
  
  <li> <code class="cmd">poll</code> (<em class="english">interval</em>), codé sur 8 bits, quantifie dans le cas d'un client ou d'un pair la <strong class="defin">période de resynchronisation</strong> exprimée en <strong>secondes</strong> mais codée en <strong>échelle logarithmique à base 2</strong>. </li>	
  
  <div class="nobullet"> <em class="remark">Par exemple</em>, la valeur <code class="cmd">10</code> exprime une période de resynchronisation de <em class="bold">2<sup>10</sup> = 1024 s</em>.  </div>
  
  <li> <code class="cmd">precision</code>, codé sur 8 bits, quantifie dans le cas d'un serveur ou d'un pair la <strong class="defin">précision d'horloge</strong> exprimée en <strong>secondes</strong> mais codée en <strong>échelle logarithmique</strong>. </li>	
  
  <div class="nobullet"> <em class="remark">Par exemple</em>, la valeur <code class="cmd">-18</code> exprime une précision de <em class="bold">2<sup>−18</sup> ≃ 3,8 × 10<sup>−6</sup> s</em> (soit environ 4 µs).  </div>

  <li> <code class="cmd">root delay</code> et <code class="cmd">root dispersion</code> sont codés l'un et l'autre sur 32 bits dans un <strong>format décimal à virgule fixe non signé</strong> ; ils sont dédiés à des mesures de durées de transmission déterminées durant le protocole d'échanges de messages entre un client et un serveur pour optimiser la valeur du <strong>timestamp</strong> à transmettre au client. </li>

  <li> <code class="cmd">reference id. / kiss of death</code>, codé sur 32 bits, prend <strong class="specialLB">différentes formes</strong> selon la réponse apportée par le serveur à une requête : </li>
  <ul>
  	<li> En cas de <strong class="warning">refus ou échec</strong> (champ <code>stratum</code> codé <code>0</code> – cf. supra), il s'agit d'un message de débogage, appelé <strong class="defin">kiss of death</strong> codé sous la forme d'une <strong>chaîne de 4 caractères <em class="sigle">ASCII</em></strong> ; la liste des codes standardisés est consultables sur le site de l'<strong><em class="sigle">IANA</em></strong> <a class="external" href="https://www.iana.org/assignments/ntp-parameters/ntp-parameters.xhtml#ntp-parameters-2" target="_BLANK"></a>. </li>

  	<li> En cas de <strong class="pros">succès</strong>, de la part d'un <strong>serveur primaire</strong> (champ <code>stratum</code> codé <code>1</code>), il s'agit d'un message précisant l'<strong class="defin">horloge de référence</strong> à laquelle le serveur est relié, codée sous la forme d'une <strong>chaîne de 3 ou 4 caractères <em class="sigle">ASCII</em></strong> justifiée à gauche (l'octet n° 15 éventuellement non employé est mis à  <code>0</code>) ; la liste des codes usuels est consultables sur le site de l'<strong><em class="sigle">IANA</em></strong> <a class="external" href="https://www.iana.org/assignments/ntp-parameters/ntp-parameters.xhtml#ntp-parameters-1" target="_BLANK"></a> ; </li>

  	<div class="nobullet"> <em class="remark">Par exemple</em>, le code <code>GAL</code> désigne un satellite du système de positionnement européen <strong>Galileo</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Galileo_(système_de_positionnement)" target="_BLANK">W</a>.  </div>
  
  	<li> En cas de <strong class="pros">succès</strong>, de la part d'un <strong>serveur secondaire</strong> (champ <code>stratum</code> codé <code>2</code> ou plus), le champ contient le <strong class="defin">numéro de référence</strong> du serveur, exprimé en notation hexadécimale et établi automatiquement à partir de son <strong class="defin">adresse IP</strong>. </li>
  </ul>

  <div class="nobullet"> <em class="remark">Remarque</em> : dans un message de <strong>requête</strong> envoyé par un <strong>client</strong>, le contenu du champ <code class="cmd">reference id.</code> est <strong class="defin">indifférent</strong>. </div>

  <li> Les <strong class="specialLB">quatre timestamps</strong> sont à <strong class="warning">ne pas confondre</strong> :  </li>
  <ul>
  	<li> <code class="cmd">ref</code> indique l'instant de la <strong class="defin">dernière synchronisation</strong> de la machine (client ou serveur) ; </li>
  
  	<li> <code class="cmd">org</code> indique l'instant de l'<strong class="defin">émission</strong> (origine) du message de <strong>requête</strong> du client ; </li>

  	<li> <code class="cmd">rec</code> indique l'instant de <strong class="defin">réception</strong> par le serveur du message de <strong>requête</strong> du client ; </li>

  	<li> <code class="cmd">xmt</code> indique l'instant d'<strong class="defin">émission</strong> de la <strong>réponse</strong> du serveur à la requête du client. </li>
  </ul>
  <div class="nobullet"> Lors d'une <strong>resynchronisation</strong>, il incombe au client de mémoriser l'instant où il reçoit la réponse du serveur, qui constitue ce qu'on appelle le <strong class="defin">destination timestamp</strong> (<code>dst</code>). </div>

  <div class="complement">
  <p> La donnée des <strong class="specialLB">cinq timestamps</strong> cités supra permet d'optimiser la valeur du <strong>timestamp</strong> à employer pour régler l'horloge du client, afin d'atteindre une <strong class="title">précision de synchronisation</strong> <strong class="pros">meilleure que la seconde</strong>. </p>

  <p> Signalons par ailleurs que dans un <strong>message <em class="sigle">NTP</em></strong>, la <strong class="title">valeur</strong> <code class="cmd">0</code> affectée à un <strong>timestamp</strong> ne correspond <strong class="warning">pas</strong> à la date <strong class="specialT">epoch 0</strong> (cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#NTPtimestamp"></a>). Elle signifie que ce <strong>timestamp</strong> est <strong class="defin">indéterminé</strong> – ce qui est typiquement le cas lorsqu'un <strong>client</strong> n'est <strong>pas encore synchronisé</strong>. </p>
  </div><!-- complement -->
</ul>

<p> Quant au codage de la <strong class="specialLB">partie optionnelle</strong> d'un <strong>message <em class="sigle">NTP</em></strong>, il ne sera <strong class="cons">pas abordé ici</strong>. On consultera les <strong><em class="sigle">RFC 5905</em></strong> <a class="external" href="https://datatracker.ietf.org/doc/html/rfc5905#section-7.5" target="_BLANK"></a>, <strong><em class="sigle">7822</em></strong> <a class="external" href="https://datatracker.ietf.org/doc/html/rfc7822" target="_BLANK"></a> et <strong><em class="sigle">8573</em></strong> <a class="external" href="https://datatracker.ietf.org/doc/html/rfc8573" target="_BLANK"></a> pour s'en informer. </p>


<!-- expert -->
<h4> Décodage des valeurs de <em class="english">timestamp</em> </h4>


<div class="complement">
<p> Rappelons que la convention de <strong class="title">gros boutisme</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Boutisme" target="_BLANK">W</a> (en anglais, <em class="english">big endianness</em>) systématiquement employée dans le <strong class="defin">format des paquets</strong> des protocoles des <strong>réseaux <em class="sigle">TCP/IP</em></strong> est l'<strong class="warning">inverse</strong> de celle adoptée pour l'<strong>encodage des données</strong> en programmation (notamment en langage <strong>C</strong>) – cf. chap. C3‑I <a class="previous" href="../../ModuleC/C3-Numeration/Cc3-1_typesGeneralites.html#boutisme" target="_BLANK">C</a>. </p>

<p> Par conséquent, lorsqu'on souhaite exploiter dans un programme la valeur d'un champ <strong class="specialLB">timestamp</strong> contenu dans un <strong>message <em class="sigle">NTP</em></strong>, il est nécessaire de <strong class="defin">réordonner</strong> ses octets dans l'<strong class="warning">ordre inverse</strong> de celui d'enregistrement dans le message. </p>
</div><!-- complement -->

<div class="exemples"><p class="exemples"></p>
<p> Pour illustrer cette nécessité, on détaille des extraits de code en langage <strong>C++</strong> des programmes fournis avec le sujet de TP R2‑4 <a class="external" href="Rtp2-4_clientNTP.html" target="_BLANK"></a> où l'on met en œuvre un <strong class="title">client <em class="sigle">NTP</em></strong> sur une <strong class="Arduino">carte Arduino</strong> équipée d'un shield <em class="mark">Ethernet</em>. </p>

<p class="square"> On analyse d'abord le code de la fonction nommée <code class="prettyprint lang-c">decodeTimestamp</code> qui décode la <strong class="title">partie entière d'un timestamp</strong>. Elle retourne une <strong class="specialN">valeur</strong> de type <code class="prettyprint lang-c">uint32_t</code> et possède <strong class="specialT">deux arguments formels</strong> : </p>
<ul>
	<li> <code class="prettyprint lang-c">ntpMessage</code> qui est un pointeur sur le <strong class="defin">tableau d'octets</strong> mémorisant le <strong>message <em class="sigle">NTP</em></strong> envoyé par le serveur de temps ; </li>

	<li> <code class="prettyprint lang-c">startByte</code> qui est le <strong class="defin">numéro du premier octet</strong> où est codé la <strong>partie entière du timestamp</strong> à décoder dans le <strong>message <em class="sigle">NTP</em></strong> envoyé par le serveur de temps. </li>
</ul>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:91">
uint32_t decodeTimestamp(byte * ntpMessage, int8_t byteOffset) {
  uint32_t ntpTimestamp = 0;
  for (int8_t byteRank = 0, bitShift = 24; byteRank <= 3; byteRank++, bitShift -= 8) {
    ntpTimestamp |= (uint32_t(ntpMessage[byteOffset + byteRank])) << bitShift;
  }
  return ntpTimestamp;
}
</pre>
<!---------- ne pas indenter ---------->

<p> Avec une boucle <code class="prettyprint lang-c">for</code> (cf. les lignes nº 92 à 95), cette fonction accède successivement aux <strong class="specialG">4 octets</strong> encodant le <strong class="specialLB">timestamp</strong> – les éléments de tableau identifiés par l'expression <code class="prettyprint lang-c">ntpMessage[byteOffset + byteRank]</code> – et effectue : </p>
<ul>
	<li> la <strong>conversion</strong> de l'octet dans le type <code class="prettyprint lang-c">uint32_t</code> ; </li>

	<li> le <strong>décalage vers la gauche</strong> (<code class="prettyprint lang-c">&lt;&lt;</code>) des bits de l'octet de la valeur de la <strong>variable de boucle</strong> <code class="prettyprint lang-c">bitShift</code> <strong>rangs</strong>, laquelle est initialisée à <code>24</code> et décrémentée de <code>8</code> à chaque itération de la boucle ; ainsi : </li>
  <ul>
  	<li> les bits du <strong class="specialG">1<sup>er</sup> octet</strong> sont décalés de 24 rangs  pour former le <strong>4<sup>e</sup> octet</strong> (octet de poids fort) de la partie entière du <em class="english">timestamp</em> ; </li>

  	<li> les bits du <strong class="specialG">2<sup>e</sup> octet</strong>  sont décalés de 24 - 8 = 16 rangs pour former le <strong>4<sup>e</sup> octet</strong> de la partie entière du <em class="english">timestamp</em> ; </li>

  	<li> et ainsi de suite jusqu'au 4 <strong class="specialG">2<sup>e</sup> octet</strong> qui forme l'octet de poids faible de la partie du <em class="english">timestamp</em> ;</li>
  </ul>

	<li> la « <strong>concaténation</strong> » des bits de l'octet avec l'<strong class="specialPB">opérateur bit à bit</strong> à affectation combinée <code class="prettyprint lang-c">|=</code> dans la variable locale <code class="prettyprint lang-c">ntpTimestamp</code> préalablement déclarée de type <code class="prettyprint lang-c">uint32_t</code>.  </li>
</ul>

<p> Un <strong class="specialO">appel</strong> de la fonction <code class="prettyprint lang-c">decodeTimestamp</code> est codé dans la fonction <code class="prettyprint lang-c">getUnixTimestamp</code> pour décoder la partie entière du <strong class="defin">timestamp</strong> <code class="cmd">xmt</code> à l'instant d'émission du <strong>message <em class="sigle">NTP</em></strong> par le serveur de temps : </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:111">
  uint32_t xmtTimestamp = decodeTimestamp(ntpMessage, 40);
</pre>
<!---------- ne pas indenter ---------->

<p> sachant que cette donnée commence à l'<strong>octet nº 40</strong> dans le message. </p>


<p class="square"> Quant au décodage de la <strong class="title">partie factionnaire d'un timestamp</strong>, il est réalisé par la fonction <code class="prettyprint lang-c">decodeFracTimestamp</code> qui possède les <strong class="specialT">mêmes arguments formels</strong> que la fonction <code class="prettyprint lang-c">decodeTimestamp</code> mais retourne une <strong class="specialN">valeur</strong> de type <code class="prettyprint lang-c">float</code>. </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:99">
float decodeFracTimestamp(byte * ntpMessage, int8_t byteOffset) {
  uint32_t ntpFracTimestamp = 0;
  for (int8_t byteRank = 0, bitShift = 24; byteRank <= 3; byteRank++, bitShift -= 8) {
    ntpFracTimestamp |= (uint32_t(ntpMessage[byteOffset + byteRank])) << bitShift;
  }
  float frac = 0.0;
  for (int8_t bitRank = 31; bitRank >= 0; bitRank--) {
    frac += ((ntpFracTimestamp >> bitRank) & 0b1) * pow(2, bitRank - 32);
  }
  return frac;  
}
</pre>
<!---------- ne pas indenter ---------->

<p> Elle procède en <strong class="title">deux étapes</strong> : </p>
<ul>
	<li> D'abord (cf. les lignes nº 101 à 103), elle effectue l'<strong class="specialLB">inversion de l'ordre des 4 octets</strong> encodant la partie fractionnaire du <strong class="defin">timestamp</strong> dans le <strong>message <em class="sigle">NTP</em></strong> pour former sur 32 bits un <strong class="specialMg">significande intermédiaire</strong> binaire. </li>

	<div class="nobullet"> C'est exactement le <strong class="pros">même algorithme</strong> que celui de la fonction <code class="prettyprint lang-c">decodeTimestamp</code> exposé supra. </div>

	<li> Puis (cf. les lignes nº 104 à 107) elle effectue la <strong class="specialLB">conversion</strong> de ce <strong class="specialMg">significande</strong> en une <strong>somme de puissances fractionnaires de 2</strong> dans une variable locale <code class="prettyprint lang-c">frac</code> de type <code class="prettyprint lang-c">float</code>. Dans une boucle <code class="prettyprint lang-c">for</code>, en procédant <strong>bit par bit</strong>  dans l'<strong>ordre décroissant</strong> des rangs  (c'est‑à‑dire de <code class="prettyprint lang-c">31</code> à <code class="prettyprint lang-c">0</code>), elle opère : </li>
	<ul>
		<li> le <strong>décalage vers la droite</strong> (<code class="prettyprint lang-c">&gt;&gt;</code>) jusqu'au rang zéro et le <strong>masquage</strong> de tous les autres bits (<code class="prettyprint lang-c">& 0b1</code>), ce qui isole la valeur du bit (<code>0</code> ou <code>1</code>) ;  </li>
	
		<li> la multiplication de cette valeur binaire par la <strong>puissance fractionnaire de 2</strong>, c'est‑à‑dire avec l'<strong>exposant négatif</strong> <code class="prettyprint lang-c">bitRank - 32</code> (donc allant de <code>-1</code> à <code>-32</code>) ; </li>

		<li> l'ajout de cette valeur fractionnaire à la variable <code class="prettyprint lang-c">frac</code>.</li>
	</ul>
	
	<div class="nobullet"> C'est un <strong class="pros">algorithme similaire</strong> à celui qui permet déterminer la valeur fractionnaire du significande d'une valeur de <strong class="specialG">type flottant</strong>, qui est expliqué au chap. C3‑V <a class="previous" href="../../ModuleC/C3-Numeration/Cc3-5_typesFlottants.html#significande" target="_BLANK">C</a>.</div>
</ul>

<p> Un <strong class="specialO">appel</strong> de la fonction <code class="prettyprint lang-c">decodeFracTimestamp</code> est notamment codé dans la fonction <code class="prettyprint lang-c">getUnixTimestamp</code> pour décoder la <strong class="title">partie fractionnaire du timestamp</strong> <code class="cmd">xmt</code> à l'instant d'émission du <strong>message <em class="sigle">NTP</em></strong> par le serveur de temps : </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:112">
  float xmtFrac = decodeFracTimestamp(ntpMessage, 44);
</pre>
<!---------- ne pas indenter ---------->

<p> sachant que cette donnée commence à l'<strong>octet nº 44</strong> dans le message. </p>

</div><!-- exemples -->
</div><!-- expert -->



<h3 id="algoNTP"> Algorithmes d'échange de messages NTP</em>  </h3>



<div class="complement"  style="display: inline-block;">
<p> Dans le cas d'un mode d'association <strong class="specialLB">client‑serveur</strong>, le déroulement du protocole <strong><em class="sigle">NTP</em></strong> se réduit à l'<strong class="title">échange de deux messages</strong> : une <strong>requête</strong> du client (message de mode <code>3</code>) suivie d'une <strong>réponse</strong> du serveur (message de mode <code>4</code>). Les <strong class="specialG">timestamp</strong> transmis dans le message de réponse suffisent au client pour se synchroniser sur l'échelle de l'<strong><em class="sigle">UTC</em></strong> avec un <strong>écart de précision</strong> inférieur à <em class="bold">±0,2 s</em>. </p>
</div><!-- complement -->

  <img class="top-right" src="../img/NTPclientServerMode.png" width="500px">
<p> Lors d'une <strong>première synchronisation</strong>, le <strong class="specialLB">client</strong> ne dispose a priori d'<strong class="cons">aucune référence temporelle calendaire</strong>. En conséquence, <strong class="specialG">tous les timestamp</strong> de son message de requête sont <strong class="specialN">mis à zéro</strong>. </p>

<p> Lors de la <strong>réception de la réponse</strong> du serveur, le <strong class="specialLB">client</strong> doit effectuer les traitements suivants pour se <strong class="defin">synchroniser</strong> à la <strong>date et heure courante de l'<em class="sigle">UTC</em></strong>. </p>
<ul>
	<li> Il doit utiliser son <strong class="defin">temps processeur</strong> pour chronométrer précisément la durée <em class="bold">Δ<var>t</var> = <var>t</var><sub>2</sub> − <var>t</var><sub>1</sub></em> entre : </li> 
	<ul>
		<li> l'instant <em class="bold"><var>t</var><sub>1</sub></em> d'envoi du message de requête ; </li>

		<li> l'instant <em class="bold"><var>t</var><sub>2</sub></em> de réception du message de réponse.  </li>
	</ul>

	<li> Il doit calculer la durée <em class="bold">Δ<var>t'</var> = <var>t'</var><sub>2</sub> − <var>t'</var><sub>1</sub></em> entre : </li>
	<ul>
		<li> l'instant <em class="bold"><var>t'</var><sub>1</sub></em> de réception par le serveur du message de requête, codé dans le <strong class="specialG">timestamp</strong> <code class="cmd">rec</code> (<em class="english">received</em>) ; </li>

		<li> l'instant <em class="bold"><var>t'</var><sub>2</sub></em> d'envoi par le serveur du message de réponse, codé dans le <strong class="specialG">timestamp</strong> <code class="cmd">xmt</code> (<em class="english">emitted</em>)</li>
	</ul>
</ul>
<p> En faisant l'<strong>hypothèse</strong> que les <strong class="specialO">temps de transmission aller et retour</strong> entre le client et le serveur sont <strong class="pros">égaux</strong>, le client peut alors immédiatement synchroniser son horloge avec ce qui constituera son nouveau <strong class="specialG">timestamp de référence</strong> : <br>
<span class="inline">
	<span class="framed" style="background: white;"><em class="bold"><var>t</var><sub>ref</sub> = <var>t'</var><sub>2</sub> + (Δ<var>t</var> − Δ<var>t'</var>) / 2</em></span>
</span> </p>

<div class="remarques"><p class="remarques"></p>
<ol class="littered">
	<li> Dans la pratique, la durée <em class="bold">Δ<var>t'</var> = <var>t'</var><sub>2</sub> − <var>t'</var><sub>1</sub></em> que met le serveur à traiter la réponse d'un client est <strong class="pros">inférieure à 100 µs</strong>. Elle est <strong class="defin">négligeable</strong> en comparaison de la durée <em class="bold">Δ<var>t</var></em>, laquelle est de l'ordre de <strong class="cons">100 ms</strong> à <strong class="cons">1 s</strong>. Si l'on se contente d'une <strong class="title">précision de synchronisation</strong> de l'ordre de <strong class="title">0,1 s</strong>, alors on peut réduire la formule de calcul du <strong class="specialG">timestamp de référence</strong> à <span class="framed" style="background: white;"><em class="bold"><var>t</var><sub>ref</sub> = <var>t'</var><sub>2</sub> + Δ<var>t</var> / 2</em></span>.  </li>

	<li> En revanche, la <strong class="specialN">partie fractionnaire</strong> <strong class="specialG">f</strong> du <strong class="defin">timestamp</strong> <code class="cmd">xmt</code> ne doit <strong class="warning">pas être négligée</strong>. En effet, c'est a priori une valeur aléatoire dans l'intervalle <em class="bold">[0 ; 1 s[</em> qui peut donc aller jusqu'à 0,999… s. Une solution pour le client consiste à <strong class="title">différer le réglage</strong> de la synchronisation du complément à la seconde suivante, en synchronisant son horloge à la <strong>valeur entière immédiatement supérieure à</strong> <em class="bold"><var>t</var><sub>ref</sub></em>. </li>
</ol>
</div><!-- exemple -->



<h3> La <em>tz database</em> </h3>



<div class="complement">
<p> La <strong class="title">tz databate</strong> <a class="external" href="https://en.wikipedia.org/wiki/Tz_database" target="_BLANK">W</a> – aussi dite <strong>zoneinfo</strong> – est une <strong class="defin">base de données collaborative</strong> multi‑format qui collectionne toutes les <strong class="defin">informations historiques</strong> sur la <strong>gestion du temps calendaire</strong> dans <strong>tous les pays</strong> du globe. </p>

<div style="display: inline-block;">
  <img class="top-right" src="../img/ianaGlobe.png" width="80px">
<p> <strong class="pros">Librement accessible</strong> sur le site de l'<strong>Iana</strong> <a class="external" href="https://www.iana.org/time-zones" target="_BLANK"></a>, elle met également à la disposition de tout internaute le <strong class="defin">code source</strong> de nombreuses <strong class="defin">fonctions</strong> pour implémenter la <strong>gestion du temps calendaire</strong> dans les <strong>systèmes d'exploitation</strong> des machines. </p>
</div><!-- display -->
</div><!-- complement -->

<p> Focalisée prioritairement sur la <strong class="title">période récente</strong> écoulée depuis le 1<sup>er</sup> janvier 1970 (<em class="english">Unix Epoch</em>), elle réunit également beaucoup d'<strong class="specialLB">informations plus anciennes</strong>.  </p>






























<h2> Gestion du temps et manipulation des données calendaires </h2>



<h3> Manipulations sous <em class="mark">Linux</em> </h3>



<h4> Accès à la date et heure courante et aux réglages temporels du système  </h4>


<!-- pour une future version, parler de l'horloge temps‑réel (RTC) et de la commande sudo hwclock -->


<div style="display:inline-block;">
	<img class="top-right" src="../img/clockCinnamon.png" width="500px">
<p> Si le système d'exploitation de la machine est dotée d'un <strong class="specialN">bureau</strong>, l'<strong class="title">affichage de la date et heure courante</strong> est prévu par défaut – typiquement, dans un coin du <strong>tableau de bord</strong> (barre de tâche). En cliquant sur cette zone, on accède à des réglages élémentaires via une fenêtre graphique, comme on peut le voir sur la capture d'écran ci‑contre pour le système <strong class="Mint">Linux Mint</strong> / <strong class="Cinnamon">Cinnamon</strong>. Il est ainsi possible : </p>
<ul>
	<li> de <strong class="defin">choisir la zone horaire</strong>, en sélectionnant la <strong>région continentale</strong> du globe et la <strong>capitale régionale</strong> de la zone ; </li>

	<li> d'<strong class="defin">activer/désactiver la synchronisation réseau</strong> ;

	<li> ou si la synchronisation réseau est désactivée, de <strong class="defin">régler la date et heure</strong> à une valeur choisie ;  </li>

	<li> de <strong class="defin">paramétrer quelques aspects</strong> du format d'affichage de la date et heure.  </li>	
</ul>
<p> Toutefois, il n'est <strong class="cons">pas possible</strong> de paramétrer le <strong>choix du serveur de temps</strong> ou la <strong>fréquence de synchronisation</strong>. </p>
</div><!-- display -->


<div class="important">
<p> Sur une machine Linux, la <strong class="title">date et heure courante</strong> est mise en œuvre par un <strong class="defin">processus système</strong> paramétré par quelques <strong class="defin">fichiers de configuration</strong> ainsi qu'un ensemble de <strong class="specialN">fichiers binaires</strong> définissant les règles de décalage dans les différentes <strong>zones horaires</strong>.  </p>

<p> Avec les <em class="remark">droits d'administration</em>, il est possible de paramétrer ce processus via <strong class="specialLB">diverses commandes</strong>, ainsi qu'en modifiant les fichiers de configuration.  </p>
</div><!-- important -->

<div class="complement" style="margin-top: 0em">
<p> La <strong class="title">commande</strong> <code class="cmd">date</code> <a class="external" href="https://man7.org/linux/man-pages/man1/date.1.html" target="_BLANK"></a> permet notamment : </p>
<ul>
	<li> <strong>sans option</strong> ni argument, d'<strong class="defin">afficher</strong> la date et heure courante dans la <strong>zone horaire du système</strong> ;  </li>

	<li> avec l'<strong>option</strong> <code class="cmd">-u</code> ou <code class="cmd">--utc</code>, d'<strong class="defin">afficher</strong> la <strong>date et heure courante</strong> de l'<strong><em class="sigle">UTC</em></strong> (sans aucun décalage) ; </li>

	<li> avec l'<strong>option</strong> <code class="cmd">-s</code> ou <code class="cmd">--set</code> suivi d'un argument de la forme <code class="cmd">"mm/dd/yyyy hh:mm:ss"</code>, de <strong class="defin">régler</strong> la<strong> date et heure courante</strong> à la valeur ainsi codée. </li>
  
  <div class="expert">
  <div class="nobullet"> <em class="remark">Attention</em>, cette commande opérationnelle sur les distributions<em class="mark">Linux</em> « peu évoluées » comme <strong class="specialDR">Debian</strong> (<em class="mark">Raspberry Pi OS</em>, etc.) mais <strong class="cons">pas</strong> sur celles mettant en œuvre le <strong>daemon</strong> <code>systemd</code> <a class="external" href="https://fr.wikipedia.org/wiki/Systemd" target="_BLANK">W</a> comme <strong class="Mint">Linux Mint</strong>). </div>
  </div><!-- expert -->
</ul>
</div><!-- complement -->

<p class="square"> Sur les distributions de <em class="mark">Linux</em> mettant en œuvre le <strong>daemon</strong> <code>systemd</code> – <strong class="Mint">Linux Mint</strong>, par exemple – la <strong class="title">commande</strong> <code class="cmd">timedatectl</code> <a class="external" href="https://man7.org/linux/man-pages/man1/timedatectl.1.html" target="_BLANK"></a> permet notamment : </p>
<ul>
	<li> <strong>sans option</strong> ni argument, d'<strong class="defin">afficher</strong> les informations essentielle sur la <strong>date et heure courante</strong> et les <strong>réglages du système</strong> ; par exemple, on peut typiquement obtenir une sortie comme :  </li>

<!---------- ne pas indenter ---------->
<pre class="displayDark">
$ <span class="displayDarkGreen">timedatectl</span>
               Local time: dim. 2023-01-22 00:36:31 CET
           Universal time: sam. 2023-01-21 23:36:31 UTC
                 RTC time: sam. 2023-01-21 23:36:31
                Time zone: Europe/Paris (CET, +0100)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
$ 
</pre>
<!---------- ne pas indenter ----------> 

	<li> avec la <strong>commande secondaire</strong> <code class="cmd">set-time</code> suivie d'un argument de la forme <code class="cmd">"yyyy-mm-dd hh:mm:ss"</code>, de <strong class="defin">régler</strong> la <strong>date et heure courante</strong> à la valeur ainsi codée. </li>

	<li> avec la <strong>commande secondaire</strong> <code class="cmd">set-timezone</code> suivie d'un argument de la forme <code class="cmd">"region/place"</code>, de <strong class="defin">régler</strong> la <strong>zone horaire</strong> ainsi codée ;  </li>
  
  <li> avec la <strong>commande secondaire</strong> <code class="cmd">set-ntp</code> suivie d'un argument booléen (<code>1</code> ou <code>0</code>), de respectivement <strong class="defin">activer/désactiver</strong> la <strong>synchronisation</strong> du système avec un serveur de temps ;  </li>
  
  <div class="expert">
  <li> avec la <strong>commande secondaire</strong> <code class="cmd">timesync-status</code> sans argument, d'afficher les informations essentielles sur la synchronisation du système avec un serveur de temps ; par exemple, on peut typiquement obtenir une sortie comme :  </li>

<!---------- ne pas indenter ---------->
<pre class="displayDark">
$ <span class="displayDarkGreen">timedatectl</span> <span class="displayDarkRed">timesync-status</span>
               Server: 2620:2d:4000:1::41 (ntp.ubuntu.com)
Poll interval: 34min 8s (min: 32s; max 34min 8s)
         Leap: normal
      Version: 4
      Stratum: 2
    Reference: A71C1419
    Precision: 1us (-25)
Root distance: 1.174ms (max: 5s)
       Offset: +358us
        Delay: 25.992ms
       Jitter: 20.304558s
 Packet count: 19
    Frequency: -11,348ppm
$ 
</pre>
<!---------- ne pas indenter ----------> 
  </div><!-- expert -->
</ul>

<p class="square"> fichier de configuration /etc/systemd/timesyncd.conf
configuration par défaut effectuée par compilation, indiquée dans les lignes commentées

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-bash">
NTP=fr.pool.ntp.org
FallbackNTP=ntp.ubuntu.com time.nist.gov
#RootDistanceMaxSec=5
PollIntervalMinSec=64
PollIntervalMaxSec=4096
</pre>
<!---------- ne pas indenter ----------> 

<!---------- ne pas indenter ---------->
<pre class="displayDark">
$ <span class="displayDarkGreen">sudo systemctl restart</span> systemd-timesyncd
$ <span class="displayDarkGreen">timedatectl</span> <span class="displayDarkRed">timesync-status</span>
Server: 162.159.200.1 (fr.pool.ntp.org)
Poll interval: 2min 8s (min: 1min 4s; max 1h 8min 16s)
         Leap: normal
      Version: 4
      Stratum: 3
    Reference: A1A0804
    Precision: 1us (-25)
Root distance: 11.772ms (max: 5s)
       Offset: +803us
        Delay: 19.890ms
       Jitter: 0
 Packet count: 1
    Frequency: -11,563ppm
$
</pre>
<!---------- ne pas indenter ----------> 


</p>

<h4> La variable d'environnement <code>TZ</code> </h4>



<h3 id="timeLib"> Manipulations en langages <em class="mark">C/C++</em> </h3>



<div class="important">
<p> La <strong>bibliothèque standard</strong> du langage <strong>C</strong> comprend le <strong class="title">fichier d'en‑tête</strong> <code class="filename">time.h</code> <a class="external" href="https://en.cppreference.com/w/c/chrono" target="_BLANK">C</a> (<code class="filename">ctime</code> en <strong>C++</strong>). Par le biais de multiples inclusions, ce dernier déclare divers <strong class="specialG">types</strong> et <strong class="defin">fonctions</strong> pour pouvoir effectuer toutes les <strong>manipulations</strong> usuelles : </p>
<ul>
	<li> non seulement sur le <strong class="specialLB">temps calendaire</strong> – <em class="remark">avec</em> la gestion des <strong>zones horaires</strong> et du <strong><em class="sigle">DST</em></strong> ; </li>

	<li> mais aussi sur le <strong class="specialLB">temps processeur</strong>, avec si nécessaire une <strong class="pros">très haute résolution</strong>. </li>
</ul>
</div><!-- important -->

<div class="complementExpert">
<p> Certaines implémentations – notamment <strong>GCC</strong> – fournissent des <strong class="title">extensions <em class="sigle">POSIX</em></strong> de ce module, avec certaines <strong class="pros">fonctions très puissantes</strong>, à condition de définir préalablement par une directive <code class="prettyprint lang-c">#define</code> certaines <strong>pseudo‑constantes</strong> comme <code class="prettyprint lang-c">_XOPEN_SOURCE</code> ou <code class="prettyprint lang-c">_POSIX_C_SOURCE</code>. </p>	

<p> Par ailleurs, pour gérer le <strong class="specialLB">temps calendaire</strong> avec une <strong class="title">précision meilleure que la seconde</strong>, il est nécessaire de faire appel à des types et des fonctions déclarées dans le <strong>fichier d'en‑tête</strong> <code class="filename">sys/time.h</code> <a class="external" href="https://pubs.opengroup.org/onlinepubs/7908799/xsh/systime.h.html" target="_BLANK">C</a>. </p>

<p> Enfin, pour qu'un programme opère sur les <strong class="title">réglages des paramètres de temps du système d'exploitation</strong> de la machine (<em class="mark">Linux</em>), il est nécessaire de faire appel à des types et des fonctions déclarées dans le <strong>fichier d'en‑tête</strong> <code class="filename">sys/timex.h</code> <a class="external" href="https://api.riot-os.org/group__sys__timex.html" target="_BLANK">C</a>. (Il faut également que son processus d'exécution possède les droits requis.)</p>
</div><!-- complement expert -->	

<p> Toutes ces <strong>fonctionnalités</strong> sont <strong class="warning">complexes</strong> et il n'est pas envisageable de les traiter en exhaustivité dans ce chapitre. Seuls <strong class="defin">quelques rudiments</strong> et <strong>exemples académiques</strong> sont donnés ci‑après. Pour plus de détails, on pourra se reporter à cet article <a class="external" href="https://zetcode.com/articles/cdatetime/" target="_BLANK"></a>. </p>


<h4 id="typeTime"> Principaux types du temps calendaire </h4>


<div class="complement">
<p> Le fichier d'en‑tête <code class="filename">time.h</code> déclare principalement <strong class="specialG">deux types</strong> de mémorisation du <strong class="title">temps calendaire</strong> : </p>
<ul>
	<li> <code class="prettyprint lang-c">time_t</code> est un <strong class="specialG">type scalaire</strong>, laissé à la liberté d'implémentation, pour déclarer toute donnée représentant un <strong class="specialLB">timestamp Unix</strong>. </li>

  <div class="expert">
  <div class="nobullet"> Ce type est presque toujours <strong class="specialO">signé</strong> pour satisfaire aux exigences des normes <strong><em class="sigle">POSIX</em></strong> – notamment pour permettre l'enregistrement de dates antérieures au 1<sup>er</sup> janvier 1970 (dates de naissance d'utilisateurs, par exemple). </div>
  
  <div class="nobullet"> De plus, il est déjà implémenté dans les distributions <em class="mark">Linux</em> avec une largeur de <strong>64 bits</strong>, mais seuls ses <strong class="defin">32 bits de bas rangs</strong> sont <strong>exploités et accessibles</strong> (les 32 bits de hauts rangs sont réservés pour un usage ultérieur). </div>

  <div class="nobullet"> Une valeur du type <code class="prettyprint lang-c">time_t</code> peut usuellement être saisie ou affichée en entrées‑sorties formatées directement avec la <strong class="specialDR">spécification de conversion</strong> <code class="cmd">%ld</code>. </div>
  </div><!-- expert -->

	<li> <code class="type">tm</code> est un <strong class="specialG">type structuré</strong> – <code class="prettyprint lang-c">struct</code>, cf. chap. C5‑V <a class="next" href="../../ModuleC/C5-StructuresPointeurs/Cc5-5_structuresHeterogenes.html" target="_BLANK">C</a> – pour déclarer toute donnée représentant une <strong class="specialLB">date et heure</strong> définie par ses <strong class="specialLB">composantes calendaires</strong> (année, mois, jour, heure, etc.). En anglais, cette structure est appelée <em class="english">broken‑down time</em>. </li>
  
  <div class="expert">
	<div class="nobullet"> Plus en détails, ces composantes calendaires représentées par <strong class="specialN">huit champs</strong> de type <code class="prettyprint lang-c">int</code> décrits dans le tableau ci‑dessous : </div>
  <div style="overflow-x: auto; margin: 0.5em;">
	<table style="margin: 0em; ">
  	<tr>
  		<th> identificateur </th> 
  		<th> valeurs <br> nominales </th>
  		<th> composante calendaire représentée </th> 
  	</tr>	
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_sec</code> </th> 
  		<td> <code>0</code> à <code>60</code> </td>
  		<td> nombre de <strong>secondes</strong> écoulées dans la minute courante (valeur <code>60</code> lors d'une seconde additionnelle – cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#leapSeconds"></a>) </td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_min</code> </th> 
  		<td> <code>0</code> à <code>59</code> </td>
  		<td> nombre de <strong>minutes</strong> écoulées dans l'heure courante </td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_hour</code> </th> 
  		<td> <code>0</code> à <code>23</code> </td>
  		<td> nombre de <strong>heures</strong> écoulées dans le jour courante </td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_mday</code> </th> 
  		<td> <code>1</code> à <code>31</code> </td>
  		<td> numéro du <strong>jour</strong> dans le mois courant (<em class="english">month day</em>)</td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_mon</code> </th> 
  		<td> <code>0</code> à <code>11</code> </td>
  		<td> nombre de <strong>mois</strong> écoulés dans l'année courante – ce n'est <strong class="warning">pas le numéro du mois</strong> </td>
  	</tr>
    <tr>
  		<td> <code class="prettyprint lang-c">tm_year</code> </th> 
  		<td> ≥ <code>0</code> </td>
  		<td> nombre d'<strong>années</strong> écoulées depuis 1900 – ce n'est <strong class="warning">pas le numéro d'année</strong> </td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_wday</code> </th> 
  		<td> <code>0</code> à <code>6</code> </td>
  		<td> nombre de <strong>jours</strong> écoulés depuis le dernier dimanche (<em class="english">week day</em>) </td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_yday</code> </th> 
  		<td> <code>0</code> à <code>365</code> </td>
  		<td> nombre de <strong>jours</strong> écoulés depuis le 1<sup>er</sup> janvier (<em class="english">year day</em>) </td>
  	</tr>
  	<tr>
  		<td> <code class="prettyprint lang-c">tm_isdst</code> </th> 
  		<td> ≥ <code>0</code> </td>
  		<td> indicateur booléen de l'<strong>heure d'été</strong> (<em class="english">daylight saving time</em> – cf. supra <a class="supra" href="Rc2-6_serviceTemps.html#DST"></a>) où <code>0</code> représentant l'heure d'hiver et toute valeur positive l'heure d'été </td>
  	</tr>
  </table>
  </div><!-- overflow -->

  <div class="nobullet"> Et comme pour tout type <code class="prettyprint lang-c">struct</code>, on accède aux différents champs d'une donnée de <strong class="specialG">type</strong> <code class="type">tm</code> avec l'<strong class="defin">opérateur de sélection</strong> <code class="prettyprint lang-c">.</code> (cf. chap. C5‑V <a class="next" href="../../ModuleC/C5-StructuresPointeurs/Cc5-5_structuresHeterogenes.html#accessOperator" target="_BLANK">C</a>). </div>

  <div class="nobullet"> <em class="remark">Attention</em>. Pour toute <strong class="specialN">affectation directe</strong> d'une valeur à l'un des champs d'une donnée de <strong class="specialG">type</strong> <code class="type">tm</code>, le compilateur ne procède à <strong class="warning">aucune vérification</strong> si la valeur se situe <strong class="cons">hors de ses valeurs nominales</strong>. C'est donc au codeur de prendre cette précaution, soit en procédant par arithmétique cyclique et en tenant compte des répercussions sur les autres champs, soit en appelant la <strong>fonction</strong> <code class="prettyprint lang-c">mktime</code> (cf. infra) qui automatise de tels traitements. </div>
  </div><!-- expert -->
</ul>
</div><!-- complement -->

<p> Chacun de ces deux types a ses <strong class="title">usages privilégiés</strong> : </p>
<ul>
	<li> Le <strong class="specialG">type</strong> <code class="prettyprint lang-c">time_t</code> est incontournable pour mémoriser une <strong class="defin">date et heure <em class="sigle">UTC</em></strong> à partir de celle du <strong class="specialLB">système</strong> (à l'aide de la fonction <code class="prettyprint lang-c">time</code> – cf. infra) ou de la partie entière du <strong class="specialLB">timestamp <em class="sigle">NTP</em></strong> transmis par un serveur de temps. </li>

  <div class="exemples">
  <p class="exemple"> Si <code class="prettyprint lang-c">ntpNow</code> est une variable de type <code class="prettyprint lang-c">uint32_t</code> mémorisant la partie entière du <strong class="specialLB">timestamp <em class="sigle">NTP</em></strong> transmis par un serveur de temps, on peut déclarer une variable mémorisant le <strong class="title">timestamp Unix</strong> correspondant par le code ci‑dessous : </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:10">
  const uint32_t unixEpoch = 2208988800;
  time_t unixNow = ntpNow - unixEpoch;
</pre>
<!---------- ne pas indenter ----------> 

  </div><!-- exemple -->	

	<div class="nobullet"> Le type <code class="prettyprint lang-c">time_t</code> peut aussi être utilisé pour effectuer des <strong class="defin">calculs de durée</strong> entre deux dates directement par soustraction, ou pour déterminer une date et heure à partir d'une autre avec un <strong class="defin">décalage</strong> – par addition ou soustraction – d'une <strong>durée exprimée en secondes</strong> ou d'autres unités à nombre de secondes fixe : la minute (60 s), l'heure (3600 s), le jour (86400 s) mais pas le mois ni l'année. </div>
  
  <div class="exemples">
  <p class="exemple"> Pour déterminer une date et heure <em class="bold"><var>D</var><sub>2</sub></em> fixée <strong class="defin">100 jours après</strong> une date et heure <em class="bold"><var>D</var><sub>1</sub></em> définie par son <strong>timestamp Unix</strong> <code class="prettyprint lang-c">t1</code>, il suffit de calculer le <strong>timestamp Unix</strong> <code class="prettyprint lang-c">t2</code> par une instruction comme : </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:10">
  t2 = t1 + 86400 * 100
</pre>
<!---------- ne pas indenter ----------> 

  </div><!-- exemple -->

   
	<li> Le <strong class="specialG">type</strong> <code class="type">tm</code> est incontournable pour mémoriser toute <strong class="defin">date et heure calendaire</strong> particulière. Il suffit juste d'<strong>adapter la valeur de chaque champ</strong> compte‑tenu de son intervalle de valeurs nominales. </li>

  <div class="exemples">
  <p class="exemple"> On peut mémoriser la <strong class="title">date et heure</strong> de signature de l'Armistice de la première guerre mondiale – le <strong>11 novembre 1918 à 5 h 15</strong> <a class="external" href="https://fr.wikipedia.org/wiki/Armistice_du_11_novembre_1918" target="_BLANK">W</a> – dans la variable <code class="prettyprint lang-c">armistice</code> par le code suivant : </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:10">
  struct tm armistice = {
    .tm_sec   = 0,
    .tm_min   = 15,
    .tm_hour  = 5,
    .tm_mday  = 11,
    .tm_mon   = 10, // november (0 = January)
    .tm_year  = 18  // 1918
  };
</pre>
<!---------- ne pas indenter ----------> 

  <p> sachant qu'il n'est <strong class="pros">pas indispensable</strong> de coder les valeurs pour les <strong>autres champs</strong> – ils peuvent être automatiquement calculés grâce à la <strong>fonction</strong> <code class="prettyprint lang-c">mktime</code> (cf. infra). </p>
  </div><!-- exemple -->
  
  <div class="remarques"><p class="remarques">  </p>
  <ol class="littered">
  	<li> Déterminer dans le type <code class="prettyprint lang-c">time_t</code> la valeur du <strong class="title">timestamp Unix</strong> d'une date et heure calendaire serait <strong class="cons">beaucoup moins commode</strong> : il faudrait calculer le nombre de seconde séparant cette date du 1<sup>er</sup> janvier 1970.</li>

  	<li> On va voir infra que le <strong class="specialG">type</strong> <code class="type">tm</code>  est également commode pour déterminer une date à partir d'une autre avec un <strong class="defin">décalage</strong> d'une durée exprimée dans <strong class="pros">n'importe quelle unité</strong> – notamment les mois et années, ce qui n'est <strong class="cons">pas commode</strong> avec le type <code class="prettyprint lang-c">time_t</code>.</li>
  </ol>
  </div><!-- remarques -->
</ul>


<h4 id="fonctionsTime"> Principales fonctions de manipulation du temps calendaire </h4>


<div class="complement">
<p> Les <strong class="title">fonctions</strong> déclarées dans le fichier d'en‑tête <code class="filename">time.h</code> sont, pour la plupart, des fonctions de <strong class="defin">conversion entre différents formats</strong> de représentation d'une <strong>date et heure</strong>. Elles ont la particularité d'opérer sur des <strong class="defin">arguments</strong> de type <strong>pointeur</strong>, donc avec un passage par adresse.  </p>
</div><!-- complement -->

<p> Les fonctions qui sont présentées ci‑après sont <strong class="pros">les plus usuelles</strong>. Elles sont décrites par leur <strong>prototype</strong>. </p>
<ol class="numbered">
	<li id="timeFunction"> 

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
// current time
time_t time(time_t * arg);
</pre>
<!---------- ne pas indenter ---------->  

	La fonction <code class="prettyprint lang-c">time</code> <a class="external" href="https://en.cppreference.com/w/c/chrono/time" target="_BLANK">C</a> retourne la valeur du <strong class="defin">timestamp Unix</strong> correspondant à la <strong>date et heure courante</strong> fournie lors de l'exécution par le <strong>système d'exploitation</strong> de la machine cible sur laquelle le programme s'exécute, dans la <strong>zone horaire <em class="sigle">UTC+0</em></strong>. </li>
  
  <div class="expert">
  <div class="nobullet"> L'<strong class="specialT">argument formel</strong> <code class="prettyprint lang-c">arg</code> peut être le <strong>pointeur</strong> <code class="prettyprint lang-c">NULL</code> (c'est le cas usuel), sinon un pointeur sur une <strong>variable déclarée de type</strong> <code class="prettyprint lang-c">time_t</code> qui prend alors la valeur retournée par la fonction (par déréférencement, cf. chap. C5‑I <a class="next" href="http://www.lycee-ferry-versailles.fr/snir/ModuleR/C5-StructuresPointeurs/Cc5-1_pointeursGeneralites.html#operDeref" target="_BLANK"></a>). </div>

  <div class="nobullet"> En cas d'<strong class="cons">erreur</strong> (typiquement, pas de <em class="english">timestamp Unix</em> fourni par le système), la fonction retourne la valeur <code class="prettyprint lang-c">(time_t) (-1)</code>, c'est‑à‑dire <code>-1</code> si le type <code class="prettyprint lang-c">time_t</code> est implémenté <strong class="specialO">signé</strong>, sinon la valeur maximale encodable dans ce type (par rebouclage cyclique). </div> 
  </div><!-- expert -->

  <div class="exemples">
  <p class="exemple"> Le programme ci‑dessous affecte à la variable <code class="prettyprint lang-c">systNow</code> la valeur du <strong>timestamp Unix</strong> de la <strong class="defin">date et heure courante <em class="sigle">UTC</em></strong> du système. </p>

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
#include &lt;stdio.h&gt;
#include &lt;time.h&gt;

int main(void) {
  time_t utc = time(NULL);
  printf("Unix timestamp now: %ld\n", systNow);
  return 0;
}
</pre>
<!---------- ne pas indenter ----------> 
  
  <p> Exécuté sur <strong class="OnlineGDB">OnlineGDB</strong> le 20 janvier 2023 à 13:06:40, il a produit l'affichage : </p>

<!---------- ne pas indenter ---------->
<pre class="displayDark">
Unix timestamp now: 1674216400
</pre>
<!---------- ne pas indenter ----------> 

  <div class="expert">
  <p> <em class="remark">Remarque</em>. On aurait pu aussi coder la ligne nº 5 par : </p>	

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:5">
  time_t utc = 0;  time(&utc);
</pre>
<!---------- ne pas indenter ----------> 

  </div><!-- expert -->
  </div><!-- exemple -->
  
	<li id="gmtimeFunction" style="margin-top: 1.5em;">  

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
// GMT time
struct tm * gmtime(const time_t * timer);
</pre>
<!---------- ne pas indenter ---------->  

	La fonction <code class="prettyprint lang-c">gmtime</code> <a class="external" href="https://en.cppreference.com/w/c/chrono/gmtime" target="_BLANK">C</a> effectue la <strong class="defin">conversion</strong> du <strong>timestamp Unix</strong> passé par l'<strong class="specialLB">argument</strong> <code class="prettyprint lang-c">timer</code>  en une <strong>valeur structurée</strong> de <strong class="specialG">type</strong> <code class="prettyprint lang-c">tm</code>, retournée via un pointeur sur une <strong>variable préalablement déclarée</strong> de ce type. Elle opère <strong class="defin">sans décalage de zone horaire</strong>, c'est‑à‑dire en restant dans la <strong>zone horaire <em class="sigle">UTC+0</em></strong> – anciennement <strong><em class="sigle">GMT</em></strong>. </li>
  
  <div class="exemples">
  <p class="exemple"> Le programme ci‑dessous affiche les différents champs de la variable <code class="prettyprint lang-c">thenTM</code> déclarée de <strong class="specialG">type structuré</strong> <code class="type">tm</code> et initialisée à la <strong class="defin">date et heure calendaire</strong> par une composition des fonctions <code class="prettyprint lang-c">gmtime</code> et <code class="prettyprint lang-c">time</code>. </p> 

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
#include &lt;stdio.h&gt;
#include &lt;time.h&gt;

int main(void) {
	time_t then = 1674216400;
  struct tm tmThen = *gmtime(&then);
  printf("tm_sec:  %d, tm_min: %d, tm_hour: %d\n", 
          tmThen.tm_sec,  tmThen.tm_min, tmThen.tm_hour);
  printf("tm_mday: %d, tm_mon: %d, tm_year: %d\n", 
          tmThen.tm_mday, tmThen.tm_mon, tmThen.tm_year);
  printf("tm_wday: %d, tm_yday: %d, tm_isdst: %d\n",
          tmThen.tm_wday, tmThen.tm_yday, tmThen.tm_isdst);
  return 0;
}

</pre>
<!---------- ne pas indenter ----------> 
  initialise la <strong class="defin">variable structurée</strong> <code class="prettyprint lang-c">tmThen</code> avec la <strong>date et heure</strong> identique à celle encodée comme un <em class="english">timestamp Unix</em> dans la variable <code class="prettyprint lang-c">now</code>. </p>
  </div><!-- exemple -->
 
  <li style="margin-top: 1.5em;"> 

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
// local time (in the local timezone)
struct tm * localtime(const time_t * timer);
</pre>
<!---------- ne pas indenter ---------->  

	La fonction <code class="prettyprint lang-c">localtime</code> <a class="external" href="https://en.cppreference.com/w/c/chrono/localtime" target="_BLANK">C</a>  effectue la <strong class="defin">même conversion</strong> que la fonction <code class="prettyprint lang-c">gmtime</code>, mais en opérant un <strong class="defin">décalage dans la zone horaire</strong> définie dans l'<strong>environnement d'exécution du programme</strong> – par défaut, celle du système d'exploitation.</li>
  
  <div class="exemples">
  <p class="exemple"> En prolongement des exemples précédents, l'instruction ci‑dessous : <br>
  <span class="inline">
  	<code class="prettyprint lang-c">struct tm tmNowLocal = *gmtime(&now);</code>
  </span> <br>
  initialise la <strong class="defin">variable structurée</strong> <code class="prettyprint lang-c">tmNowLocal</code> avec la <strong>date et heure</strong> décalée dans la <strong class="defin">zone horaire du système</strong> et en tenant compte du paramètre <strong class="defin"><em class="sigle">DST</em></strong> par rapport à celle encodée dans le <em class="english">timestamp Unix</em> <code class="prettyprint lang-c">now</code>. </p>
  </div><!-- exemple -->

  <li style="margin-top: 1.5em;"> 

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
// make time
time_t mktime(struct tm * arg);
</pre>
<!---------- ne pas indenter ---------->  

	La fonction <code class="prettyprint lang-c">mktime</code> <a class="external" href="https://en.cppreference.com/w/c/chrono/mktime" target="_BLANK">C</a> effectue la <strong class="defin">conversion inverse</strong> de celle opérée par la fonction <code class="prettyprint lang-c">localtime</code>. À partir d'une <strong>date et heure locale</strong> encodée dans une variable de type structuré <code class="type">tm</code>, pointée par son <strong class="specialT">argument</strong> <code class="prettyprint lang-c">arg</code>, elle retourne une valeur de <strong>timestamp Unix<em class="sigle">UTC+0</em></strong> en tenant compte du <strong class="defin">décalage de zone horaire</strong> et du paramètre <strong class="defin"><em class="sigle">DST</em></strong> définis dans l'environnement d'exécution du programme (par défaut, les réglages du système). </li>
  
  <div class="exemples">
  <p class="exemple"> En prolongement des exemples précédents, l'instruction ci‑dessous : <br>
  <span class="inline">
  	<code class="prettyprint lang-c">now = mktime(&localNow);</code>
  </span> <br>
  affecte à la variable <code class="prettyprint lang-c">now</code> la <strong class="defin">même valeur</strong> de <strong>timestamp Unix</strong> que celle qu'elle avait auparavant. </p>
  </div><!-- exemple -->

	<div class="expert">
	<div class="nobullet"> <em class="remark">Remarque</em>. Les <strong class="title">champs</strong> <code class="prettyprint lang-c">tm_wday</code> et <code class="prettyprint lang-c">tm_yday</code> sont <strong class="defin">ignorés</strong> pour le calcul de la <strong>valeur de retour</strong>, qui se base uniquement sur les composantes calendaires qui définissent une date et heure de façon usuelle, c'est‑à‑dire avec avec l'année, le mois, le jour, les heures, les minutes et les secondes. </div>
	</div><!-- expert -->	
  
  <li style="margin-top: 1.5em;"> 

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
// string from time
size_t strftime(char * str, size_t count, const char * format, const struct tm * arg);
</pre>
<!---------- ne pas indenter ---------->  

  La fonction <code class="prettyprint lang-c">strftime</code> <a class="external" href="https://en.cppreference.com/w/c/chrono/strftime" target="_BLANK">C</a> effectue la <strong class="defin">transcription</strong> en une <strong class="specialN">chaîne de caractères formatée</strong> dans l'<strong class="specialT">argument</strong> <code class="prettyprint lang-c">str</code> de la <strong>date et heure</strong> mémorisée dans l'<strong class="specialT">argument</strong> <code class="prettyprint lang-c">arg</code> de <strong class="specialG">type structuré</strong> <code class="type">tm</code>, sachant que : </li>


  <li style="margin-top: 1.5em;"> 

<!---------- ne pas indenter ---------->
<pre class="prettyprint lang-c linenums:1">
// string parsed time
char * strptime(char * str, const char * format, struct tm * arg);
</pre>
<!---------- ne pas indenter ---------->  




La fonction <code class="prettyprint lang-c">strptime</code> <a class="external" href="https://pubs.opengroup.org/onlinepubs/009695399/functions/strptime.html" target="_BLANK">C</a>… 
   <!-- à finir -->

  </li>
</ol><!-- numbered -->
	




<h3> Manipulations dans l'environnement <em class="mark">Arduino</em> </h3>



<h4> Le module <em>Time</em> </h4>



<p> Dans l'environnement <strong class="Arduino">Arduino</strong>, les modules <code class="filename">time</code> et <code class="filename">ctime</code> des bibliothèques standards des langages <strong>C/C++</strong> sont <strong class="cons">difficilement utilisables</strong> (en particulier sur les cartes à cœur <strong><em class="sigle">AVR</em></strong> – <em class="mark">Uno</em>, <em class="mark">Nano</em>, <em class="mark">Mega</em>, etc.). En l'<strong class="defin">absence de système d'exploitation</strong> pour entretenir un <strong>temps calendaire</strong>, il faut en implémenter un à l'aide de la fonction <code class="prettyprint lang-c">millis</code> – cf. chap. C2‑VIII <a class="previous" href="../../moduleC/C2-ElementsLangage/Cc2-8_gestionTemps.html#millis" target="_BLANK">C</a>. </p>

<div class="important">
<p> Justement, le module <code class="filename">Time</code> <a class="external" href="https://www.arduino.cc/reference/en/libraries/time/" target="_BLANK">A</a> de la bibliothèque <strong class="Arduino">Arduino</strong> (fichier d'en‑tête <code class="filename">TimeLib.h</code>) implémente un <strong class="title">temps calendaire</strong>, c'est‑à‑dire une <strong>horloge temps‑réel</strong> qui s'incrémente en <strong>tâche de fond</strong>. </p>

<p> De plus, ce module met à la disposition du codeur des <strong class="specialG">types</strong> et quelques <strong class="defin">fonctions</strong> similaires à ceux et celles qui sont déclaré(e)s dans le fichier d'en‑tête <code class="filename">time.h</code> du langage <strong>C</strong>, mais avec des <strong class="cons">fonctionnalités plus réduites</strong>. </p>
</div><!-- important -->

<p> Dans le module <code class="filename">Time</code>, on trouve essentiellement <strong class="title">deux types</strong> : </p>
<ul>
	<li> le <strong class="specialG">type scalaire</strong> <code class="cmd">time_t</code> (synonyme de <code class="prettyprint lang-c">unsigned long</code> – <strong class="specialN">32 bits</strong> quel que soit le modèle de carte <strong class="Arduino">Arduino</strong>) ; </li>

  <div class="expert">
	<div class="nobullet"> ce format est choisi pour être <strong class="pros">polyvalent</strong> dans la mesure où il permet d'encoder : </div>
	<ul>
		<li> une <strong>partie entière</strong> de <strong class="specialLB">timestamp <em class="sigle">NTP</em></strong> ;  </li>
	
		<li> les <strong>valeurs positives</strong> de <strong class="specialLB">timestamp Unix</strong> ;  </li>
	</ul>
  </div><!-- expert -->

	<li> le <strong class="specialG">type structuré</strong> <code class="cmd">tmElements_t</code>, similaire au type <code class="cmd">tm</code> du <strong>C/C++</strong> mais avec seulement 7 champs – le paramètres <strong><em class="sigle">DST</em></strong> n'étant <strong class="cons">pas inclus</strong>. </li>
</ul>

<!-- compléter avec des exemples -->
<p> On trouve également de <strong class="title">nombreuses fonctions</strong> : </p>
<ul>
	<li> la fonction <code class="prettyprint lang-c">now</code> qui <strong>retourne</strong> la valeur de la <strong class="specialLB">date et heure courante</strong> mémorisée sous la forme d'un <strong>timestamp Unix</strong> ; </li>

	<li> les fonctions <code class="prettyprint lang-c">hour</code>, <code class="prettyprint lang-c">minute</code>, <code class="prettyprint lang-c">second</code>, <code class="prettyprint lang-c">day</code>, <code class="prettyprint lang-c">weekday</code>, <code class="prettyprint lang-c">month</code> et <code class="prettyprint lang-c">year</code>, qui retournent respectivement l'<strong>heure</strong>, les <strong>minutes</strong>, les <strong>secondes</strong>, le <strong>jour du mois</strong>, le <strong>jour de la semaine</strong>, le <strong>mois</strong> et l'<strong>année</strong> correspondant à un <strong>timestamp Unix</strong> passé en argument ; </li>

	<div class="nobullet"> de plus, lorsque l'<strong>argument</strong> est <strong class="defin">omis</strong>, c'est la valeur du <strong>timestamp courant</strong> (délivré par la fonction <code class="prettyprint lang-c">now</code>) qui est considéré ; autrement dit, un appel comme <code class="prettyprint lang-c">hour()</code> donne la valeur de l'heure courante ; </div>

	<li> la fonction <code class="prettyprint lang-c">setTime</code> qui <strong>règle</strong> la <strong class="defin">date et heure courante</strong> de la carte à partir de la valeur d'un <strong>timestamp Unix</strong> passé comme <strong class="defin">argument</strong>… </li>
</ul>

<div class="expert">
<p> Le paramètre <strong><em class="sigle">DST</em></strong> n'est <strong class="cons">pas pris en charge</strong> dans le module <code class="filename">Time</code> mais il existe d'<strong>autres modules</strong> de bibliothèque qui permettent de gérer cet aspect, notamment <code class="filename">Timezone</code>, décrit ci‑dessous. </p>
</div><!-- expert -->


<h4 id="ArduinoTimezone"> Le module <em>Timezone</em> </h4>


<div class="important">
<p> Le module <code class="filename">Timezone</code> <a class="external" href="https://www.arduino.cc/reference/en/libraries/timezone/" target="_BLANK">A</a> de la bibliothèque <strong class="Arduino">Arduino</strong>  implémente la <strong class="title">gestion automatique du décalage horaire</strong> avec <strong class="pros">prise en compte du <em class="sigle">DST</em></strong> dans une zone horaire déterminée. </p>

<p> Il <strong>utilise</strong> les éléments de code du <strong>module</strong> <code class="filename">Time</code> (types, fonctions), dont il <strong class="defin">complète les fonctionnalités</strong>. </p>
</div><!-- important -->

<!-- à compléter -->






<h4> Le module <em>NTPclient</em> </h4>


<!-- à compléter -->


</section>


</div><!-- #scrollingFrame -->

</div><!-- #mainFrame -->

</body>

</html>
